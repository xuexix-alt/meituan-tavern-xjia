# 调试指南（店铺解析与缓存）

## 事件表

- `shop:parse:requested`：detail = { messageId }
- `shop:parse:done`：detail = { messageId, parsed, errors }
- `shop:cache:updated`：detail = { scope, count, op, id? }

在前台监听：`window.addEventListener('shop:parse:done', e => console.log(e.detail))`

## 错误码

- P001 JSON 解析失败
- P002 YAML 解析失败
- P003 文本标签解析失败
- D001 必填字段缺失
- D002 去重冲突

## 常用排查步骤

1. 点击“触发解析”或发送含占位符的消息，观察控制台 `[parse]` 日志。
2. 导入失败时检查：文件 ≤ 5MB、条数 ≤ 200、结构包含 `shops` 或数组。
3. 去重冲突：确认店铺 `id` 或 name/address/city 组合唯一。
4. 缓存异常：在控制台运行 `window.ShopStore?.getShops()` 查看当前作用域数据。
5. UI 不更新：确认已收到 `shop:cache:updated` 事件，或手动刷新 Discover 页。
