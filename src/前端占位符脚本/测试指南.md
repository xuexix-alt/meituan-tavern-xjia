# 前端占位符脚本 - 快速测试指南

## 测试前准备

### 1. 构建脚本
```bash
pnpm build
```

### 2. 上传到酒馆助手
- 将 `dist/前端占位符脚本/index.js` 上传到酒馆助手脚本库
- 或使用GitHub Actions自动部署（推荐）

## 测试场景

### 测试场景 1：自动插入占位符

**测试步骤：**
1. 在酒馆中开始一个新聊天
2. 发送一条消息（如：你好）
3. AI回复后，检查消息内容是否包含【前端占位符】

**期望结果：**
- ✅ 消息末尾自动添加了【前端占位符】
- ✅ 显示成功通知（如果启用）

**如果失败：**
- 检查脚本是否已启用
- 检查 `auto_insert` 设置是否为 `true`
- 查看浏览器控制台日志

---

### 测试场景 2：已有占位符时不重复插入

**测试步骤：**
1. 手动在消息末尾添加【前端占位符】
2. 再次发送新消息
3. 观察原有消息的占位符是否被保留

**期望结果：**
- ✅ 已有占位符的消息不会被修改
- ✅ 新消息会自动添加占位符

---

### 测试场景 3：手动检查功能

**测试步骤：**
1. 清空一条消息的占位符
2. 点击"检查占位符"按钮
3. 观察消息是否自动添加占位符

**期望结果：**
- ✅ 点击按钮后立即执行检查
- ✅ 缺少占位符的消息被自动补充
- ✅ 显示相应提示信息

---

### 测试场景 4：自定义占位符文本

**测试步骤：**
1. 在脚本设置中修改 `placeholder_text` 为 `【我的自定义占位符】`
2. 发送一条新消息
3. 检查消息末尾的占位符

**期望结果：**
- ✅ 使用自定义的占位符文本
- ✅ 格式保持一致

---

### 测试场景 5：禁用自动插入

**测试步骤：**
1. 将 `auto_insert` 设置为 `false`
2. 发送新消息
3. 点击"检查占位符"按钮

**期望结果：**
- ✅ 自动插入被禁用，消息无占位符
- ✅ 手动点击按钮时可以插入占位符

---

## 常见问题解决

### Q1: 脚本没有自动插入占位符

**可能原因：**
- 脚本未启用
- `auto_insert` 设置为 `false`
- 脚本权限不足

**解决方法：**
1. 检查脚本状态是否为"已启用"
2. 确认 `auto_insert: true`
3. 重新导入脚本并授予权限

### Q2: 点击按钮没有反应

**可能原因：**
- 按钮未注册成功
- 脚本加载失败

**解决方法：**
1. 刷新页面重新加载脚本
2. 查看浏览器控制台是否有错误信息
3. 检查 `eventOn` 是否正确注册

### Q3: 插入的占位符格式不正确

**可能原因：**
- 消息本身格式异常
- 换行符处理问题

**解决方法：**
1. 检查 `insertPlaceholder()` 函数
2. 确认消息以正确的换行符结尾
3. 查看 `containsPlaceholder()` 是否正确识别

---

## 调试技巧

### 1. 查看脚本日志
打开浏览器开发者工具（F12），在控制台中查看日志：
```
[前端占位符] 脚本已加载
[前端占位符] 消息发送完成，自动检查
[前端占位符] 已插入占位符到当前楼层
```

### 2. 启用详细日志
在脚本顶部临时添加：
```typescript
console.log('当前设置:', settings);
console.log('当前楼层消息:', getCurrentFloorMessages());
```

### 3. 逐步测试
将 `checkAndInsertPlaceholder()` 函数分解测试：
1. 先测试 `getCurrentFloorMessages()`
2. 再测试 `containsPlaceholder()`
3. 最后测试 `insertPlaceholder()`

---

## 脚本设置示例

### 推荐设置（自动模式）
```json
{
  "enabled": true,
  "placeholder_text": "【前端占位符】",
  "auto_insert": true,
  "show_notification": true
}
```

### 推荐设置（手动模式）
```json
{
  "enabled": true,
  "placeholder_text": "【前端占位符】",
  "auto_insert": false,
  "show_notification": true
}
```

---

## 验证清单

完成以下检查项目，确认脚本正常工作：

- [ ] 脚本成功加载并显示提示信息
- [ ] 发送新消息后自动插入占位符
- [ ] 已有占位符的消息不被重复修改
- [ ] "检查占位符"按钮可以手动触发
- [ ] 自定义占位符文本生效
- [ ] 禁用自动插入后仅手动模式有效
- [ ] 聊天切换时脚本正常运行
- [ ] 页面卸载时脚本正确清理

---

## 下一步

测试完成后，您可以：

1. **优化脚本**：根据实际使用需求调整功能
2. **自定义设置**：修改默认配置以适应特定场景
3. **集成到项目**：在生产环境中使用
4. **分享给其他用户**：提供脚本文件和使用说明

如有问题，请查看 `使用说明.md` 或检查浏览器控制台的错误信息。
