{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_53ff6257bd8fdf8315af10a81f7e3da1/node_modules/vue-loader/dist/exportHelper.js","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/external var \"Vue\"","webpack://tavern_helper_template/./src/ç»„ç»‡éƒ¨æ´¾æ¥ä¸€ä¸ªå¹´è½»äººçŠ¶æ€æ /App.vue?1901","webpack://tavern_helper_template/src/ç»„ç»‡éƒ¨æ´¾æ¥ä¸€ä¸ªå¹´è½»äººçŠ¶æ€æ /App.vue?6ee5","src://tavern_helper_template/src/ç»„ç»‡éƒ¨æ´¾æ¥ä¸€ä¸ªå¹´è½»äººçŠ¶æ€æ /index.ts"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","import { defineComponent as _defineComponent } from 'vue';\nimport { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, normalizeStyle as _normalizeStyle, openBlock as _openBlock, createElementBlock as _createElementBlock, Transition as _Transition, withCtx as _withCtx, createVNode as _createVNode, normalizeClass as _normalizeClass, renderList as _renderList, Fragment as _Fragment, createTextVNode as _createTextVNode, vModelSelect as _vModelSelect, withDirectives as _withDirectives, withModifiers as _withModifiers } from \"vue\";\nconst _hoisted_1 = [\"data-theme\"];\nconst _hoisted_2 = { class: \"header-section\" };\nconst _hoisted_3 = {\n    key: 0,\n    class: \"progress-bar-container\"\n};\nconst _hoisted_4 = { class: \"progress-info\" };\nconst _hoisted_5 = { class: \"progress-text\" };\nconst _hoisted_6 = { class: \"progress-count\" };\nconst _hoisted_7 = { class: \"progress-bar\" };\nconst _hoisted_8 = { class: \"info-layout\" };\nconst _hoisted_9 = { class: \"global-info-bar\" };\nconst _hoisted_10 = { class: \"info-item chapter\" };\nconst _hoisted_11 = { class: \"info-content\" };\nconst _hoisted_12 = { class: \"text\" };\nconst _hoisted_13 = { class: \"info-item time\" };\nconst _hoisted_14 = { class: \"info-content\" };\nconst _hoisted_15 = { class: \"text\" };\nconst _hoisted_16 = { class: \"info-item location\" };\nconst _hoisted_17 = { class: \"info-content\" };\nconst _hoisted_18 = { class: \"text\" };\nconst _hoisted_19 = { class: \"photo-section\" };\nconst _hoisted_20 = {\n    key: 0,\n    class: \"loading-spinner\"\n};\nconst _hoisted_21 = [\"src\", \"alt\"];\nconst _hoisted_22 = {\n    key: 2,\n    class: \"photo-placeholder\"\n};\nconst _hoisted_23 = {\n    key: 3,\n    class: \"photo-placeholder\"\n};\nconst _hoisted_24 = { class: \"photo-caption\" };\nconst _hoisted_25 = { class: \"char-name\" };\nconst _hoisted_26 = [\"title\"];\nconst _hoisted_27 = { class: \"content-section\" };\nconst _hoisted_28 = { class: \"info-grid\" };\nconst _hoisted_29 = { class: \"card full-width character-selector-card\" };\nconst _hoisted_30 = { class: \"tabs-nav\" };\nconst _hoisted_31 = [\"onClick\"];\nconst _hoisted_32 = {\n    key: 0,\n    class: \"card full-width thought-card\"\n};\nconst _hoisted_33 = { class: \"text-box thought\" };\nconst _hoisted_34 = {\n    key: 1,\n    class: \"card full-width action-card\"\n};\nconst _hoisted_35 = { class: \"text-box action\" };\nconst _hoisted_36 = { class: \"card info-card two-column-split\" };\nconst _hoisted_37 = { class: \"detail-list\" };\nconst _hoisted_38 = { class: \"label\" };\nconst _hoisted_39 = { class: \"value\" };\nconst _hoisted_40 = { class: \"card appearance-card two-column-split\" };\nconst _hoisted_41 = { class: \"appearance-list\" };\nconst _hoisted_42 = { class: \"appearance-label\" };\nconst _hoisted_43 = { class: \"appearance-text\" };\nconst _hoisted_44 = {\n    key: 1,\n    class: \"empty-state\"\n};\nconst _hoisted_45 = { key: 0 };\nconst _hoisted_46 = { key: 1 };\nconst _hoisted_47 = { key: 2 };\nconst _hoisted_48 = { key: 3 };\nconst _hoisted_49 = { class: \"modal-header\" };\nconst _hoisted_50 = { class: \"form-group\" };\nimport { ref, computed, onMounted, onUnmounted, watch, nextTick } from 'vue';\n// âœ… å¹¶è¡ŒåŠ è½½å›¾ç‰‡å‡½æ•°ï¼ˆæ”¹è¿›ç‰ˆï¼‰+ å¤šé•œåƒæ”¯æŒ + è¿›åº¦å›è°ƒ\n// ä¸€æ¬¡æ€§å‘èµ·æ‰€æœ‰è¯·æ±‚ï¼Œå¤§å¹…æå‡åŠ è½½é€Ÿåº¦\n// âš ï¸ ä»…åŠ è½½ JPG æ ¼å¼ï¼Œé¿å…åŠ è½½ä½“ç§¯å·¨å¤§çš„ PNG\n// ğŸ’¡ ä½¿ç”¨å¤šé•œåƒ CDN ç­–ç•¥ï¼Œè‡ªåŠ¨çº§è”æ•…éšœè½¬ç§»ï¼Œç¡®ä¿å¿«é€Ÿç¨³å®šçš„åŠ è½½\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'App',\n    setup(__props) {\n        const loadImagesParallel = async (roleName, rangeStart = 0, rangeEnd = 30, onProgress) => {\n            // CDN é•œåƒåˆ—è¡¨ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åˆ—ï¼‰\n            const cdnMirrors = [\n                'https://fastly.jsdelivr.net/gh/xuexix-alt/meituan-tavern-xjia/image', // Fastly é•œåƒï¼ˆä¸»è¦ï¼Œé€Ÿåº¦å¿«ï¼‰\n                'https://gcore.jsdelivr.net/gh/xuexix-alt/meituan-tavern-xjia/image', // Gcore é•œåƒï¼ˆå¤‡é€‰1ï¼‰\n                'https://testingcf.jsdelivr.net/gh/xuexix-alt/meituan-tavern-xjia/image', // testingcf é•œåƒï¼ˆå¤‡é€‰2ï¼Œå›½å†…ä¼˜åŒ–ï¼‰\n            ];\n            let lastError = null;\n            // éå†æ‰€æœ‰ CDN é•œåƒï¼Œç›´åˆ°æ‰¾åˆ°å¯ç”¨çš„\n            for (const cdnPrefix of cdnMirrors) {\n                try {\n                    console.log(`[å›¾ç‰‡] ğŸ”„ å°è¯•ä½¿ç”¨é•œåƒ: ${cdnPrefix}`);\n                    const imageUrls = [];\n                    // åŸºç¡€æ–‡ä»¶åï¼ˆæ— æ•°å­—åç¼€ï¼‰- ä»…åŠ è½½ JPG\n                    if (rangeStart === 0) {\n                        imageUrls.push({\n                            url: `${cdnPrefix}/${encodeURIComponent(roleName)}.jpg`,\n                            name: `${roleName}.jpg`,\n                        });\n                    }\n                    // å¸¦æ•°å­—åç¼€çš„æ–‡ä»¶ - ä»…åŠ è½½ JPG\n                    for (let i = Math.max(1, rangeStart); i <= rangeEnd; i++) {\n                        imageUrls.push({\n                            url: `${cdnPrefix}/${encodeURIComponent(roleName)}${i}.jpg`,\n                            name: `${roleName}${i}.jpg`,\n                        });\n                    }\n                    const rangeDesc = rangeStart === 0 && rangeEnd === 30\n                        ? 'å…¨éƒ¨å›¾ç‰‡ï¼ˆ0-30ï¼‰'\n                        : `ç¬¬${rangeStart}-${rangeEnd}å¼ `;\n                    console.log(`[å›¾ç‰‡] ğŸ” å¼€å§‹åŠ è½½ \"${roleName}\" çš„${rangeDesc}...`);\n                    // å¹¶è¡Œå‘èµ·æ‰€æœ‰è¯·æ±‚ï¼Œå¸¦è¿›åº¦å›è°ƒ\n                    const results = await Promise.allSettled(imageUrls.map(async ({ url, name }) => {\n                        const result = await loadImageAsBlob(url, name);\n                        if (result && onProgress) {\n                            onProgress(1); // æˆåŠŸåŠ è½½ä¸€å¼ ï¼Œé€šçŸ¥è¿›åº¦+1\n                        }\n                        return result;\n                    }));\n                    // ç­›é€‰æˆåŠŸçš„å›¾ç‰‡ + ç»Ÿè®¡å¤±è´¥æ•°é‡\n                    const blobUrls = [];\n                    let failedCount = 0;\n                    results.forEach((result, index) => {\n                        if (result.status === 'fulfilled' && result.value) {\n                            blobUrls.push(result.value);\n                            console.log(`[å›¾ç‰‡] âœ… æˆåŠŸåŠ è½½: ${imageUrls[index].name}`);\n                        }\n                        else {\n                            failedCount++;\n                        }\n                    });\n                    // æ±‡æ€»æ—¥å¿—ï¼šæˆåŠŸçš„è¾“å‡ºè¯¦æƒ…ï¼Œå¤±è´¥çš„åªæ˜¾ç¤ºæ•°é‡\n                    if (failedCount > 0) {\n                        console.log(`[å›¾ç‰‡] â­ï¸  å…¶ä½™ ${failedCount} ä¸ªè¯·æ±‚æ— å›¾ç‰‡æ–‡ä»¶ï¼ˆå±æ­£å¸¸æƒ…å†µï¼‰`);\n                    }\n                    console.log(`[å›¾ç‰‡] ğŸ“Š æˆåŠŸæ‰¾åˆ° ${blobUrls.length} å¼ å¯ç”¨å›¾ç‰‡ï¼ˆæ‰«æèŒƒå›´ï¼š${imageUrls.length} ä¸ª URLï¼‰`);\n                    if (blobUrls.length > 0) {\n                        console.log(`[å›¾ç‰‡] âœ… ä½¿ç”¨é•œåƒ \"${cdnPrefix}\" åŠ è½½æˆåŠŸ`);\n                        return blobUrls;\n                    }\n                }\n                catch (error) {\n                    lastError = error;\n                    console.warn(`[å›¾ç‰‡] âš ï¸ é•œåƒå¤±è´¥: ${cdnPrefix}`, lastError.message);\n                    // ç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªé•œåƒ\n                    continue;\n                }\n            }\n            // æ‰€æœ‰é•œåƒéƒ½å¤±è´¥\n            console.error(`[å›¾ç‰‡] âŒ æ‰€æœ‰ CDN é•œåƒéƒ½æ— æ³•åŠ è½½ \"${roleName}\"`, lastError);\n            return [];\n        };\n        // ä» URL åŠ è½½å•ä¸ªå›¾ç‰‡ä¸º Blob URL\n        const loadImageAsBlob = (url, fileName) => {\n            return new Promise((resolve) => {\n                // ä½¿ç”¨ fetch åŠ è½½å›¾ç‰‡ï¼Œé¿å… Canvas è½¬æ¢çš„æ€§èƒ½å¼€é”€\n                fetch(url, { mode: 'cors' })\n                    .then((response) => {\n                    if (!response.ok) {\n                        throw new Error(`HTTP ${response.status}`);\n                    }\n                    return response.blob();\n                })\n                    .then((blob) => {\n                    // åˆ›å»º Blob URLï¼Œæ¯” Base64 å¿«å¾—å¤š\n                    const blobUrl = URL.createObjectURL(blob);\n                    resolve(blobUrl);\n                })\n                    .catch((error) => {\n                    // å¤±è´¥ç›´æ¥è¿”å› nullï¼Œä¸Šå±‚ä¼šæ±‡æ€»ç»Ÿè®¡\n                    resolve(null);\n                });\n            });\n        };\n        // âœ… IndexedDB åˆå§‹åŒ–\n        const initImageDatabase = async () => {\n            try {\n                return new Promise((resolve, reject) => {\n                    const request = indexedDB.open('TavernImageCache', 1);\n                    request.onerror = () => {\n                        console.warn('[æ•°æ®åº“] âŒ IndexedDB æ‰“å¼€å¤±è´¥');\n                        reject(request.error);\n                    };\n                    request.onsuccess = () => {\n                        const db = request.result;\n                        console.log('[æ•°æ®åº“] âœ… IndexedDB å·²åˆå§‹åŒ–');\n                        resolve(db);\n                    };\n                    request.onupgradeneeded = (event) => {\n                        const db = event.target.result;\n                        if (!db.objectStoreNames.contains('images')) {\n                            db.createObjectStore('images', { keyPath: 'roleName' });\n                            console.log('[æ•°æ®åº“] ğŸ“¦ åˆ›å»º images å¯¹è±¡å­˜å‚¨');\n                        }\n                    };\n                });\n            }\n            catch (e) {\n                console.warn('[æ•°æ®åº“] âŒ åˆå§‹åŒ–å¤±è´¥:', e);\n                return null;\n            }\n        };\n        let imageDatabase = null;\n        // âœ… ä» IndexedDB è·å–å›¾ç‰‡äºŒè¿›åˆ¶æ•°æ®\n        const getImageFromDB = async (roleName) => {\n            try {\n                if (!imageDatabase) {\n                    imageDatabase = await initImageDatabase();\n                    if (!imageDatabase)\n                        return null;\n                }\n                return new Promise((resolve) => {\n                    const transaction = imageDatabase.transaction(['images'], 'readonly');\n                    const store = transaction.objectStore('images');\n                    const request = store.get(roleName);\n                    request.onsuccess = () => {\n                        if (request.result && request.result.blob) {\n                            const blob = request.result.blob;\n                            const size = blob.size;\n                            console.log(`[æ•°æ®åº“] âœ… ä» IndexedDB è·å– \"${roleName}\" çš„å›¾ç‰‡ (${(size / 1024).toFixed(2)} KB)`);\n                            if (size === 0) {\n                                console.warn(`[æ•°æ®åº“] âš ï¸ è­¦å‘Š: \"${roleName}\" çš„ Blob æ•°æ®ä¸ºç©º (0 bytes)`);\n                            }\n                            resolve(blob);\n                        }\n                        else {\n                            console.log(`[æ•°æ®åº“] â„¹ï¸ \"${roleName}\" åœ¨ IndexedDB ä¸­æ— æ•°æ®`);\n                            resolve(null);\n                        }\n                    };\n                    request.onerror = () => {\n                        console.warn(`[æ•°æ®åº“] âŒ æŸ¥è¯¢å¤±è´¥: ${roleName}`);\n                        resolve(null);\n                    };\n                });\n            }\n            catch (e) {\n                console.warn('[æ•°æ®åº“] âŒ è·å–å¤±è´¥:', e);\n                return null;\n            }\n        };\n        // âœ… ä¿å­˜å›¾ç‰‡åˆ° IndexedDB\n        const saveImageToDB = async (roleName, blob) => {\n            try {\n                if (!imageDatabase) {\n                    imageDatabase = await initImageDatabase();\n                    if (!imageDatabase)\n                        return false;\n                }\n                return new Promise((resolve) => {\n                    const transaction = imageDatabase.transaction(['images'], 'readwrite');\n                    const store = transaction.objectStore('images');\n                    const request = store.put({ roleName, blob });\n                    request.onsuccess = () => {\n                        console.log(`[æ•°æ®åº“] ğŸ’¾ å·²ä¿å­˜ \"${roleName}\" åˆ° IndexedDB`);\n                        resolve(true);\n                    };\n                    request.onerror = () => {\n                        console.warn(`[æ•°æ®åº“] âŒ ä¿å­˜å¤±è´¥: ${roleName}`);\n                        resolve(false);\n                    };\n                });\n            }\n            catch (e) {\n                console.warn('[æ•°æ®åº“] âŒ ä¿å­˜å¤±è´¥:', e);\n                return false;\n            }\n        };\n        // âœ… æ”¹è¿›çš„å›¾ç‰‡ç¼“å­˜è·å–å‡½æ•°ï¼ˆæ·»åŠ  IndexedDB + å¤šé•œåƒæ”¯æŒï¼‰\n        const getImageFromCache = async (roleName) => {\n            try {\n                // 1. é¦–å…ˆå°è¯•ä» IndexedDB è·å–\n                const cachedBlob = await getImageFromDB(roleName);\n                if (cachedBlob && cachedBlob.size > 0) {\n                    const blobUrl = URL.createObjectURL(cachedBlob);\n                    console.log(`[å›¾ç‰‡] âœ… ä½¿ç”¨ IndexedDB ç¼“å­˜ï¼ˆæ— éœ€é‡æ–°åŠ è½½ï¼‰`);\n                    return blobUrl;\n                }\n                else if (cachedBlob && cachedBlob.size === 0) {\n                    // âš ï¸ ç¼“å­˜æ•°æ®è¢«æŸåï¼Œåˆ é™¤åé‡æ–°åŠ è½½\n                    console.warn(`[å›¾ç‰‡] âš ï¸ IndexedDB ç¼“å­˜è¢«æŸåï¼ˆ0 bytesï¼‰ï¼Œåˆ é™¤å¹¶é‡æ–°åŠ è½½...`);\n                }\n                console.log(`[å›¾ç‰‡] ğŸ“¡ ç¼“å­˜æœªå‘½ä¸­ï¼Œæ­£åœ¨åŠ è½½ \"${roleName}\" çš„å›¾ç‰‡...ï¼ˆä½¿ç”¨å¹¶è¡ŒåŠ è½½ï¼Œé€Ÿåº¦æ›´å¿«ï¼‰`);\n                // 2. ä½¿ç”¨å¹¶è¡ŒåŠ è½½è·å–æ‰€æœ‰å¯ç”¨å›¾ç‰‡\n                const blobUrls = await loadImagesParallel(roleName);\n                if (blobUrls.length === 0) {\n                    console.log(`[å›¾ç‰‡] âŒ \"${roleName}\" æ²¡æœ‰æ‰¾åˆ°ä»»ä½•å›¾ç‰‡æ–‡ä»¶`);\n                    return null;\n                }\n                // 3. éšæœºé€‰æ‹©ä¸€å¼ å›¾ç‰‡\n                const randomIndex = Math.floor(Math.random() * blobUrls.length);\n                const selectedImageUrl = blobUrls[randomIndex];\n                console.log(`[å›¾ç‰‡] ğŸ² ä» ${blobUrls.length} å¼ å›¾ç‰‡ä¸­éšæœºé€‰æ‹©ç¬¬ ${randomIndex + 1} å¼ ï¼ˆ${selectedImageUrl ? 'æˆåŠŸ' : 'å¤±è´¥'}ï¼‰`);\n                // 4. âœ… æ”¹è¿›ï¼šä¿å­˜åˆ° IndexedDB æ—¶æ£€æŸ¥æ•°æ®å®Œæ•´æ€§\n                // ä½¿ç”¨ Promise.race å®ç°è¶…æ—¶ä¿æŠ¤\n                const savePromise = new Promise((resolve) => {\n                    fetch(selectedImageUrl)\n                        .then(r => r.blob())\n                        .then(blob => {\n                        // âœ… ç¡®ä¿ä¿å­˜çš„ä¸æ˜¯ç©º Blob\n                        if (blob.size > 0) {\n                            console.log(`[å›¾ç‰‡] ğŸ’¾ æ­£åœ¨ä¿å­˜ \"${roleName}\" åˆ° IndexedDB (${(blob.size / 1024).toFixed(2)} KB)...`);\n                            saveImageToDB(roleName, blob)\n                                .then(() => resolve())\n                                .catch(e => {\n                                console.warn('[æ•°æ®åº“] åå°ä¿å­˜å¤±è´¥:', e);\n                                resolve();\n                            });\n                        }\n                        else {\n                            console.warn(`[å›¾ç‰‡] âš ï¸ æ— æ³•ä¿å­˜ç©º Blobï¼Œè·³è¿‡ IndexedDB ç¼“å­˜`);\n                            resolve();\n                        }\n                    })\n                        .catch(e => {\n                        console.warn('[æ•°æ®åº“] åå°ä¿å­˜å¤±è´¥ï¼ˆè¯»å–å¤±è´¥ï¼‰:', e);\n                        resolve();\n                    });\n                });\n                // 5. æ¸…ç†å…¶ä»–æœªä½¿ç”¨çš„ Blob URLï¼ˆé˜²æ­¢å†…å­˜æ³„æ¼ï¼‰\n                blobUrls.forEach((url, index) => {\n                    if (index !== randomIndex) {\n                        URL.revokeObjectURL(url);\n                    }\n                });\n                // 6. ä¸ç­‰å¾…ä¿å­˜å®Œæˆï¼Œä½†ç¡®ä¿è‡³å°‘å°è¯•äº†\n                savePromise.catch(() => { });\n                return selectedImageUrl;\n            }\n            catch (e) {\n                console.warn(`[å›¾ç‰‡] è·å–å›¾ç‰‡å¤±è´¥:`, e);\n                return null;\n            }\n        };\n        // --- çŠ¶æ€ç®¡ç† ---\n        const containerRef = ref(null);\n        const statData = ref({\n            ç« èŠ‚: 'ç¤ºä¾‹ç« èŠ‚',\n            æ—¶é—´: 'ç¤ºä¾‹æ—¶é—´',\n            å½“å‰åœ°ç‚¹: 'ç¤ºä¾‹åœ°ç‚¹',\n            è§’è‰²: {\n                é™†å‰¯å‚é•¿: {\n                    å¹´é¾„: 25,\n                    èº«ä»½: 'ç¤ºä¾‹èº«ä»½',\n                    ä¸userå…³ç³»: 'ç¤ºä¾‹å…³ç³»',\n                    æ‰€å¤„ä½ç½®: 'ç¤ºä¾‹ä½ç½®',\n                    å½“å‰æƒ³æ³•: 'ç¤ºä¾‹æƒ³æ³•ï¼šè¯·åœ¨é…’é¦†ä¸­å®‰è£…é…’é¦†åŠ©æ‰‹æ‰©å±•ä»¥è·å–å®æ—¶æ•°æ®',\n                    å§¿åŠ¿: 'ç¤ºä¾‹å§¿åŠ¿',\n                    è¡£ç€: 'ç¤ºä¾‹è¡£ç€',\n                    èƒ¸ä¹³: 'ç¤ºä¾‹èƒ¸ä¹³',\n                    å†…è¡£: 'ç¤ºä¾‹å†…è¡£',\n                    ç§å¤„: 'ç¤ºä¾‹ç§å¤„',\n                    é‹è¢œ: 'ç¤ºä¾‹é‹è¢œ',\n                    ç…§ç‰‡: 'image/é™†å‰¯å‚é•¿',\n                },\n            },\n        });\n        const activeChar = ref(''); // åˆå§‹ä¸ºç©ºï¼Œç­‰å¾…åˆå§‹åŒ–\n        const showThemeModal = ref(false);\n        const currentTheme = ref(localStorage.getItem('tavern_helper_theme') || 'default');\n        const isImageLoading = ref(false);\n        // âœ… å›¾ç‰‡é¢„åŠ è½½è¿›åº¦è·Ÿè¸ª\n        const loadingProgress = ref(0); // å½“å‰å·²åŠ è½½æ•°é‡\n        const totalImages = ref(0); // æ€»å›¾ç‰‡æ•°é‡ï¼ˆé¢„ä¼°ï¼‰\n        const isPreloading = ref(false); // æ˜¯å¦æ­£åœ¨é¢„åŠ è½½\n        const preloadPhase = ref(''); // å½“å‰åŠ è½½é˜¶æ®µæè¿°\n        // --- è®¡ç®—å±æ€§ ---\n        const characterNames = computed(() => Object.keys(statData.value.è§’è‰² || {}));\n        const hasCharacters = computed(() => characterNames.value.length > 0);\n        // âœ… å½“å‰è§’è‰²çš„å›¾ç‰‡ä¿¡æ¯\n        const currentImageInfo = computed(() => {\n            if (!activeChar.value)\n                return null;\n            const currentIndex = characterNames.value.indexOf(activeChar.value);\n            if (currentIndex === -1)\n                return null;\n            const imageKey = mapRoleToImageName(activeChar.value, currentIndex);\n            const images = preloadCache.value.get(imageKey);\n            const currentIdx = imageIndexMap.value.get(imageKey) || 0;\n            return {\n                imageKey,\n                images: images || [],\n                currentIndex: currentIdx,\n                total: images?.length || 0,\n                hasMultiple: (images?.length || 0) > 1,\n            };\n        });\n        // âœ… åˆå§‹åŒ–å®Œæˆæ ‡å¿—ï¼ˆæ˜¯å¦å·²å°è¯•åŠ è½½è¿‡å›¾ç‰‡ï¼‰\n        const initializationComplete = ref(false);\n        // âœ… å›¾ç‰‡åŠ è½½å®ŒæˆçŠ¶æ€ï¼ˆç®€åŒ–é€»è¾‘ï¼šåŸºäºæ˜¯å¦æœ‰ currentPhotoUrlï¼‰\n        const imagesLoaded = computed(() => {\n            // å¦‚æœåˆå§‹åŒ–è¿˜æœªå®Œæˆï¼Œè¿”å› falseï¼ˆæ˜¾ç¤ºåŠ è½½ä¸­ï¼‰\n            if (!initializationComplete.value)\n                return false;\n            // å¦‚æœæœ‰ currentPhotoUrlï¼Œè¯´æ˜åŠ è½½æˆåŠŸ\n            if (currentPhotoUrl.value)\n                return true;\n            // å¦åˆ™è¿”å› trueï¼ˆåˆå§‹åŒ–å®Œæˆä½†æ²¡æœ‰å›¾ç‰‡ï¼Œæ˜¾ç¤ºå ä½ç¬¦ï¼‰\n            return true;\n        });\n        // âœ… é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªè§’è‰²ï¼ˆ{{user}}ï¼‰\n        const defaultActiveChar = computed(() => {\n            return characterNames.value.length > 0 ? characterNames.value[0] : '';\n        });\n        // âœ… è§’è‰²ååˆ—è¡¨ï¼ˆç”¨äºæ˜¾ç¤ºï¼Œç›´æ¥ä½¿ç”¨é…’é¦†è§£æåçš„åŸåï¼‰\n        // ä¾‹å¦‚ï¼š[\"å°å“¥å“¥\", \"è‹æ™´\", \"ä¸å°èŠ¹\"] - å›¾ç‰‡æ–‡ä»¶åä¸è§’è‰²åä¸€è‡´\n        const cleanedCharacterNames = computed(() => {\n            return characterNames.value.map(name => cleanCharName(name));\n        });\n        const activeCharData = computed(() => {\n            if (!activeChar.value)\n                return null;\n            // âœ… ä»å½“å‰é€‰ä¸­çš„è§’è‰²åè·å–æ•°æ®ï¼ˆ{{user}} å·²è¢«é…’é¦†æ›¿æ¢ä¸ºå®é™…ç”¨æˆ·åï¼‰\n            const data = statData.value.è§’è‰²?.[activeChar.value];\n            console.log(`[æ•°æ®] ä»\"${activeChar.value}\"è·å–æ•°æ®`);\n            return data || null;\n        });\n        // âœ… ç®€åŒ–ç‰ˆæ¸…ç†è§’è‰²åå‡½æ•°ï¼ˆä»…ç”¨äºå®‰å…¨æ£€æŸ¥ï¼‰\n        const cleanCharName = (name) => {\n            if (!name)\n                return '';\n            // åªåšåŸºæœ¬çš„å®‰å…¨æ£€æŸ¥å’Œç©ºæ ¼æ¸…ç†\n            return name.trim();\n        };\n        // âœ… å°†è§’è‰²åæ˜ å°„åˆ°å›¾ç‰‡å\n        // æ³¨æ„ï¼šç¬¬ä¸€ä¸ªè§’è‰²æ— è®ºç”¨æˆ·åæ˜¯ä»€ä¹ˆï¼Œéƒ½ä½¿ç”¨\"é™†å‰¯å‚é•¿\"çš„å›¾ç‰‡\n        const mapRoleToImageName = (roleName, roleIndex) => {\n            // ç¬¬ä¸€ä¸ªè§’è‰²ï¼ˆç´¢å¼•0ï¼‰æ°¸è¿œæ˜ å°„ä¸º\"é™†å‰¯å‚é•¿\"ï¼ˆç©å®¶è§’è‰²{{user}}ï¼‰\n            // ä¸ç®¡ç”¨æˆ·åæ˜¯\"å°å“¥å“¥\"ã€\"å¼ ä¸‰\"è¿˜æ˜¯å…¶ä»–ï¼Œéƒ½ä½¿ç”¨\"é™†å‰¯å‚é•¿\"å›¾ç‰‡\n            if (roleIndex === 0) {\n                return 'é™†å‰¯å‚é•¿';\n            }\n            // âœ… å…¶ä»–è§’è‰²ç›´æ¥ä½¿ç”¨è§’è‰²åä½œä¸ºå›¾ç‰‡å\n            // è‹æ™´ â†’ è‹æ™´\n            // ä¸å°èŠ¹ â†’ ä¸å°èŠ¹\n            // æ—å©‰ä»ª â†’ æ—å©‰ä»ª\n            // ç‹æ˜¥ç‡• â†’ ç‹æ˜¥ç‡•\n            // ç™½æ…§ â†’ ç™½æ…§\n            return cleanCharName(roleName);\n        };\n        // âœ… å›¾ç‰‡ç¼“å­˜å·²ç”±ç‹¬ç«‹çš„è„šæœ¬ç®¡ç†å™¨å¤„ç†\n        // å‰ç«¯ç•Œé¢ç›´æ¥ä»å…¨å±€ç¼“å­˜è·å–å›¾ç‰‡\n        // ? å½“å‰æ˜¾ç¤ºçš„å›¾ç‰‡URLï¼ˆå“åº”å¼ï¼‰\n        const currentPhotoUrl = ref('');\n        // ? å»¶è¿Ÿé‡Šæ”¾æ—§ Blob URLï¼ˆç­‰å¾… <img> å®Œå…¨åˆ‡æ¢åå†é‡Šæ”¾ï¼‰\n        let releaseTimer = null;\n        watch(currentPhotoUrl, (newUrl, oldUrl) => {\n            if (releaseTimer) {\n                clearTimeout(releaseTimer);\n                releaseTimer = null;\n            }\n            if (oldUrl && oldUrl.startsWith('blob:')) {\n                releaseTimer = setTimeout(() => {\n                    try {\n                        URL.revokeObjectURL(oldUrl);\n                        console.log(`[æ¸…ç†] å·²é‡Šæ”¾æ—§ Blob URL: ${oldUrl.substring(0, 50)}...`);\n                    }\n                    catch (e) {\n                        console.warn('[æ¸…ç†] é‡Šæ”¾ Blob URL å¤±è´¥:', e);\n                    }\n                    releaseTimer = null;\n                }, 500);\n            }\n        });\n        // âœ… é¢„åŠ è½½ç¼“å­˜ï¼ˆåå°é¢„åŠ è½½ä¸‹ä¸€ä¸ªè§’è‰²çš„å›¾ç‰‡ï¼Œæ¶ˆé™¤åˆ‡æ¢å»¶è¿Ÿï¼‰\n        const preloadCache = ref(new Map()); // æ”¹ä¸ºå­˜å‚¨æ‰€æœ‰å›¾ç‰‡æ•°ç»„\n        // âœ… å›¾ç‰‡ç´¢å¼•è·Ÿè¸ªï¼ˆè®°å½•æ¯ä¸ªè§’è‰²å½“å‰æ˜¾ç¤ºçš„æ˜¯ç¬¬å‡ å¼ å›¾ç‰‡ï¼‰\n        const imageIndexMap = ref(new Map());\n        /**\n         * âœ¨ æ™ºèƒ½åˆ†æ‰¹é¢„åŠ è½½æ‰€æœ‰è§’è‰²çš„æ‰€æœ‰å›¾ç‰‡\n         *\n         * ç­–ç•¥ï¼š\n         * - ç¬¬1æ‰¹ï¼ˆç«‹å³ï¼‰ï¼šé™†å‰¯å‚é•¿çš„å…¨éƒ¨31å¼ å›¾ç‰‡ â†’ é¦–å±ç«‹å³å¯ç”¨\n         * - ç¬¬2æ‰¹ï¼ˆ3ç§’åï¼‰ï¼šå…¶ä»–è§’è‰²çš„å‰5å¼ å›¾ç‰‡ â†’ å¿«é€Ÿåˆ‡æ¢æ”¯æŒ\n         * - ç¬¬3æ‰¹ï¼ˆ10ç§’åï¼‰ï¼šå…¶ä»–è§’è‰²çš„å‰©ä½™å›¾ç‰‡ï¼ˆ6-30ï¼‰ â†’ å®Œæ•´å›¾åº“\n         */\n        const smartBatchPreload = async () => {\n            if (isPreloading.value) {\n                console.log('[é¢„åŠ è½½] âš ï¸ å·²æœ‰é¢„åŠ è½½ä»»åŠ¡åœ¨è¿›è¡Œä¸­ï¼Œè·³è¿‡');\n                return;\n            }\n            isPreloading.value = true;\n            loadingProgress.value = 0;\n            // è®¡ç®—æ€»å›¾ç‰‡æ•°ï¼šæ¯ä¸ªè§’è‰²31å¼ ï¼ˆ0-30ï¼‰\n            const charCount = characterNames.value.length;\n            totalImages.value = charCount * 31;\n            console.log(`[é¢„åŠ è½½] ğŸš€ å¼€å§‹æ™ºèƒ½åˆ†æ‰¹é¢„åŠ è½½ (å…±${charCount}ä¸ªè§’è‰², é¢„è®¡${totalImages.value}å¼ å›¾ç‰‡)`);\n            try {\n                // ğŸ¯ ç¬¬1æ‰¹ï¼šç«‹å³åŠ è½½é™†å‰¯å‚é•¿çš„å…¨éƒ¨å›¾ç‰‡ï¼ˆ0-30ï¼‰\n                preloadPhase.value = 'é¦–å±åŠ è½½ä¸­';\n                console.log('[é¢„åŠ è½½] ğŸ“¦ ç¬¬1æ‰¹ï¼šé™†å‰¯å‚é•¿å…¨éƒ¨å›¾ç‰‡ï¼ˆç«‹å³ï¼‰');\n                const lufuIndex = characterNames.value.indexOf(characterNames.value[0]); // ç¬¬ä¸€ä¸ªè§’è‰²\n                if (lufuIndex !== -1) {\n                    const lufuImageName = mapRoleToImageName(characterNames.value[0], lufuIndex);\n                    await preloadCharacterImages(lufuImageName, 0, 30);\n                }\n                // ğŸ¯ ç¬¬2æ‰¹ï¼šå»¶è¿Ÿ3ç§’ååŠ è½½å…¶ä»–è§’è‰²çš„å‰5å¼ ï¼ˆ0-4ï¼‰\n                setTimeout(async () => {\n                    if (!isPreloading.value)\n                        return; // å¦‚æœå·²ç»å–æ¶ˆé¢„åŠ è½½ï¼Œåˆ™é€€å‡º\n                    preloadPhase.value = 'å¿«é€Ÿåˆ‡æ¢å‡†å¤‡ä¸­';\n                    console.log('[é¢„åŠ è½½] ğŸ“¦ ç¬¬2æ‰¹ï¼šå…¶ä»–è§’è‰²å‰5å¼ ï¼ˆå»¶è¿Ÿ3ç§’ï¼‰');\n                    for (let i = 1; i < characterNames.value.length; i++) {\n                        const charName = characterNames.value[i];\n                        const imageName = mapRoleToImageName(charName, i);\n                        await preloadCharacterImages(imageName, 0, 4);\n                    }\n                    // ğŸ¯ ç¬¬3æ‰¹ï¼šå»¶è¿Ÿ10ç§’ååŠ è½½å…¶ä»–è§’è‰²çš„å‰©ä½™å›¾ç‰‡ï¼ˆ5-30ï¼‰\n                    setTimeout(async () => {\n                        if (!isPreloading.value)\n                            return;\n                        preloadPhase.value = 'å®Œæ•´å›¾åº“åŠ è½½ä¸­';\n                        console.log('[é¢„åŠ è½½] ğŸ“¦ ç¬¬3æ‰¹ï¼šå…¶ä»–è§’è‰²å‰©ä½™å›¾ç‰‡ï¼ˆå»¶è¿Ÿ10ç§’ï¼‰');\n                        for (let i = 1; i < characterNames.value.length; i++) {\n                            const charName = characterNames.value[i];\n                            const imageName = mapRoleToImageName(charName, i);\n                            await preloadCharacterImages(imageName, 5, 30);\n                        }\n                        // å…¨éƒ¨åŠ è½½å®Œæˆ\n                        isPreloading.value = false;\n                        preloadPhase.value = 'åŠ è½½å®Œæˆ';\n                        console.log(`[é¢„åŠ è½½] âœ… å…¨éƒ¨åŠ è½½å®Œæˆï¼å…±åŠ è½½ ${loadingProgress.value} å¼ å›¾ç‰‡`);\n                        // 3ç§’åéšè—è¿›åº¦æ¡\n                        setTimeout(() => {\n                            preloadPhase.value = '';\n                        }, 3000);\n                    }, 7000); // ç¬¬2æ‰¹å®Œæˆåå†å»¶è¿Ÿ7ç§’ï¼ˆæ€»è®¡10ç§’ï¼‰\n                }, 3000); // ç¬¬1æ‰¹å®Œæˆåå»¶è¿Ÿ3ç§’\n            }\n            catch (e) {\n                console.error('[é¢„åŠ è½½] âŒ æ™ºèƒ½åˆ†æ‰¹é¢„åŠ è½½å¤±è´¥:', e);\n                isPreloading.value = false;\n                preloadPhase.value = 'åŠ è½½å¤±è´¥';\n            }\n        };\n        /**\n         * é¢„åŠ è½½æŒ‡å®šè§’è‰²çš„æŒ‡å®šèŒƒå›´å›¾ç‰‡\n         */\n        const preloadCharacterImages = async (imageName, rangeStart, rangeEnd) => {\n            try {\n                // ä½¿ç”¨è¿›åº¦å›è°ƒ\n                const onProgress = (loaded) => {\n                    loadingProgress.value += loaded;\n                };\n                // åŠ è½½å›¾ç‰‡\n                const blobUrls = await loadImagesParallel(imageName, rangeStart, rangeEnd, onProgress);\n                if (blobUrls.length === 0) {\n                    console.log(`[é¢„åŠ è½½] âš ï¸ \"${imageName}\" èŒƒå›´${rangeStart}-${rangeEnd}æ²¡æœ‰å¯ç”¨å›¾ç‰‡`);\n                    return;\n                }\n                // å°†æ‰€æœ‰å›¾ç‰‡å­˜å‚¨åˆ°é¢„åŠ è½½ç¼“å­˜ä¸­\n                const existingUrls = preloadCache.value.get(imageName) || [];\n                preloadCache.value.set(imageName, [...existingUrls, ...blobUrls]);\n                console.log(`[é¢„åŠ è½½] âœ… \"${imageName}\" èŒƒå›´${rangeStart}-${rangeEnd}åŠ è½½å®Œæˆ (${blobUrls.length}å¼ )`);\n                // åŒæ—¶ä¿å­˜åˆ° IndexedDB\n                for (const blobUrl of blobUrls) {\n                    fetch(blobUrl)\n                        .then(r => r.blob())\n                        .then(blob => {\n                        if (blob.size > 0) {\n                            saveImageToDB(imageName, blob).catch(() => { });\n                        }\n                    })\n                        .catch(() => { });\n                }\n            }\n            catch (e) {\n                console.warn(`[é¢„åŠ è½½] âŒ é¢„åŠ è½½ \"${imageName}\" èŒƒå›´${rangeStart}-${rangeEnd}å¤±è´¥:`, e);\n            }\n        };\n        /**\n         * åŠ è½½å½“å‰è§’è‰²çš„å›¾ç‰‡\n         * ä¼˜å…ˆä½¿ç”¨é¢„åŠ è½½ç¼“å­˜ï¼Œå…¶æ¬¡ä½¿ç”¨ IndexedDB ç¼“å­˜\n         */\n        const loadCurrentPhoto = async () => {\n            try {\n                // âœ… è®°å½•å½“å‰çš„ activeCharï¼Œç”¨äºç«æ€æ¡ä»¶æ£€æŸ¥\n                const targetChar = activeChar.value;\n                // âœ… è·å–å½“å‰è§’è‰²åœ¨åˆ—è¡¨ä¸­çš„ç´¢å¼•\n                const currentIndex = characterNames.value.indexOf(targetChar);\n                if (currentIndex === -1) {\n                    console.log(`[ç…§ç‰‡] å½“å‰è§’è‰²\"${targetChar}\"ä¸åœ¨è§’è‰²åˆ—è¡¨ä¸­`);\n                    currentPhotoUrl.value = '';\n                    return;\n                }\n                // âœ… è·å–è§’è‰²åï¼ˆä½œä¸ºå›¾ç‰‡æ–‡ä»¶åï¼‰\n                const imageKey = mapRoleToImageName(targetChar, currentIndex);\n                console.log(`[ç…§ç‰‡] è§’è‰²ç´¢å¼•: ${currentIndex}, è§’è‰²å: \"${targetChar}\", å›¾ç‰‡å: \"${imageKey}\"`);\n                // âœ… ä¼˜å…ˆæŸ¥è¯¢é¢„åŠ è½½ç¼“å­˜ï¼ˆæ”¹ä¸ºæ•°ç»„ï¼‰\n                if (preloadCache.value.has(imageKey)) {\n                    const preloadedUrls = preloadCache.value.get(imageKey);\n                    // âš ï¸ ç«æ€æ¡ä»¶æ£€æŸ¥ï¼šç¡®ä¿ activeChar æ²¡æœ‰å˜åŒ–\n                    if (activeChar.value !== targetChar) {\n                        console.log(`[ç…§ç‰‡] âš ï¸ ç”¨æˆ·å·²åˆ‡æ¢è§’è‰²ï¼Œæ”¾å¼ƒè®¾ç½®æ—§å›¾ç‰‡`);\n                        return;\n                    }\n                    if (preloadedUrls && preloadedUrls.length > 0) {\n                        // åˆå§‹åŒ–æˆ–è·å–å½“å‰ç´¢å¼•\n                        if (!imageIndexMap.value.has(imageKey)) {\n                            // é¦–æ¬¡åŠ è½½ï¼Œéšæœºé€‰æ‹©ä¸€å¼ \n                            const randomIndex = Math.floor(Math.random() * preloadedUrls.length);\n                            imageIndexMap.value.set(imageKey, randomIndex);\n                        }\n                        const currentIdx = imageIndexMap.value.get(imageKey) || 0;\n                        currentPhotoUrl.value = preloadedUrls[currentIdx];\n                        console.log(`[ç…§ç‰‡] ${imageKey}: ä»é¢„åŠ è½½ç¼“å­˜åŠ è½½ âš¡ (å…±${preloadedUrls.length}å¼ ï¼Œæ˜¾ç¤ºç¬¬${currentIdx + 1}å¼ )`);\n                        return;\n                    }\n                }\n                // âœ… ä» IndexedDB ç¼“å­˜ä¸­è·å–å›¾ç‰‡\n                const imageUrl = await getImageFromCache(imageKey);\n                // ?? ç«æ€æ¡ä»¶æ£€æŸ¥ï¼šç­‰å¾…å®Œæˆåï¼Œæ£€æŸ¥ activeChar æ˜¯å¦å˜åŒ–\n                if (activeChar.value !== targetChar) {\n                    console.log(`[ç…§ç‰‡] ?? ç”¨æˆ·å·²åˆ‡æ¢è§’è‰²ï¼ˆ${activeChar.value}ï¼‰ï¼Œæ”¾å¼ƒè®¾ç½®\"${targetChar}\"çš„å›¾ç‰‡`);\n                    // é‡Šæ”¾è¿™ä¸ª Blob URLï¼Œå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦å®ƒäº†\n                    if (imageUrl && imageUrl.startsWith('blob:')) {\n                        URL.revokeObjectURL(imageUrl);\n                    }\n                    return;\n                }\n                if (imageUrl) {\n                    currentPhotoUrl.value = imageUrl;\n                    console.log(`[ç…§ç‰‡] ${imageKey}: åŠ è½½æˆåŠŸ`);\n                    // å°†å‘½ä¸­çš„å›¾ç‰‡åŠ å…¥é¢„åŠ è½½ç¼“å­˜ï¼Œç¡®ä¿åç»­å¯åˆ‡æ¢\n                    const cachedList = preloadCache.value.get(imageKey) || [];\n                    if (!cachedList.includes(imageUrl)) {\n                        preloadCache.value.set(imageKey, [...cachedList, imageUrl]);\n                    }\n                    if (!imageIndexMap.value.has(imageKey)) {\n                        imageIndexMap.value.set(imageKey, 0);\n                    }\n                    // åå°è¡¥å…¨å…¨é‡å›¾ç‰‡ï¼Œå¡«å……å¯åˆ‡æ¢åˆ—è¡¨\n                    loadImagesParallel(imageKey, 0, 30)\n                        .then((urls) => {\n                        if (!urls.length)\n                            return;\n                        const merged = Array.from(new Set([...(preloadCache.value.get(imageKey) || []), ...urls]));\n                        preloadCache.value.set(imageKey, merged);\n                    })\n                        .catch(() => { });\n                }\n                else {\n                    currentPhotoUrl.value = '';\n                    console.log(`[ç…§ç‰‡] ${imageKey}: æš‚æ— å›¾ç‰‡ï¼Œæš‚ä¸æ˜¾ç¤º`);\n                }\n            }\n            finally {\n                // ? æ ‡è®°åˆå§‹åŒ–å®Œæˆï¼ˆæ— è®ºæˆåŠŸæˆ–å¤±è´¥ï¼‰\n                initializationComplete.value = true;\n            }\n        };\n        // åŸºç¡€ä¿¡æ¯æ˜ å°„\n        const basicInfo = computed(() => ({\n            'ğŸ‚ å¹´é¾„': activeCharData.value?.å¹´é¾„,\n            'ğŸ’¼ èº«ä»½': activeCharData.value?.èº«ä»½,\n            'ğŸ¤ å…³ç³»': activeCharData.value?.ä¸userå…³ç³»,\n            'ğŸ“ ä½ç½®': activeCharData.value?.æ‰€å¤„ä½ç½®,\n        }));\n        // å¤–è§‚ä¿¡æ¯æ˜ å°„\n        const appearanceInfo = computed(() => ({\n            'ğŸ‘” è¡£ç€': activeCharData.value?.è¡£ç€,\n            'ğŸŒ¸ èƒ¸ä¹³': activeCharData.value?.èƒ¸ä¹³,\n            'ğŸ‘™ å†…è¡£': activeCharData.value?.å†…è¡£,\n            'ğŸ”’ ç§å¤„': activeCharData.value?.ç§å¤„,\n            'ğŸ‘  é‹è¢œ': activeCharData.value?.é‹è¢œ,\n        }));\n        // --- æ ¸å¿ƒé€»è¾‘ ---\n        /**\n         * æ ¸å¿ƒæ•°æ®è·å–å‡½æ•°\n         * å…¼å®¹å¤šç§ APIï¼šgetCurrentMessageId / getLastMessageId\n         */\n        const fetchData = async () => {\n            try {\n                // æ£€æŸ¥é…’é¦†åŠ©æ‰‹æ¥å£æ˜¯å¦å¯ç”¨\n                const hasGetCurrent = typeof getCurrentMessageId === 'function';\n                const hasGetLast = typeof getLastMessageId === 'function';\n                const hasGetMsgs = typeof getChatMessages === 'function';\n                if (!hasGetMsgs) {\n                    console.warn('[é…’é¦†åŠ©æ‰‹] æ¥å£æœªåŠ è½½');\n                    return;\n                }\n                let targetMsg = null;\n                // å°è¯•å¤šç§æ–¹å¼è·å–æœ€æ–°æ¶ˆæ¯\n                if (hasGetCurrent) {\n                    // æ–¹å¼ 1: getCurrentMessageId (å¸¸è§äºæ—§ç‰ˆæœ¬)\n                    const msgId = getCurrentMessageId();\n                    if (msgId) {\n                        const msgs = getChatMessages(msgId);\n                        targetMsg = msgs && msgs.length > 0 ? msgs[0] : null;\n                    }\n                }\n                else if (hasGetLast) {\n                    // æ–¹å¼ 2: getLastMessageId (å¸¸è§äºæ–°ç‰ˆæœ¬)\n                    const lastId = getLastMessageId();\n                    if (lastId) {\n                        const msgs = getChatMessages(lastId);\n                        targetMsg = msgs && msgs.length > 0 ? msgs[0] : null;\n                    }\n                }\n                if (targetMsg?.data?.stat_data) {\n                    console.log('[é…’é¦†åŠ©æ‰‹] æˆåŠŸè·å–æ•°æ®');\n                    statData.value = targetMsg.data.stat_data;\n                    // ç­‰å¾… characterNames è®¡ç®—å±æ€§æ›´æ–°åå†æ£€æŸ¥\n                    await nextTick();\n                    // å¦‚æœå½“å‰æ²¡æœ‰é€‰ä¸­è§’è‰²ï¼Œä¸”æœ‰è§’è‰²æ•°æ®ï¼Œé»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ª\n                    if (!activeChar.value && characterNames.value.length > 0) {\n                        console.log(`[é»˜è®¤] è‡ªåŠ¨é€‰ä¸­ç¬¬ä¸€ä¸ªè§’è‰²: \"${characterNames.value[0]}\"`);\n                        activeChar.value = characterNames.value[0];\n                    }\n                    // æ•°æ®æ›´æ–°åè°ƒæ•´é«˜åº¦ï¼ˆå»¶è¿Ÿç­‰å¾… DOM æ›´æ–°ï¼‰\n                    await nextTick();\n                    adjustHeight();\n                }\n            }\n            catch (e) {\n                console.warn('æ•°æ®åŒæ­¥å¤±è´¥:', e);\n            }\n        };\n        const handleManualRefresh = () => {\n            fetchData();\n            isImageLoading.value = true;\n            // æ¨¡æ‹ŸåŠ è½½åŠ¨ç”»\n            const btn = document.querySelector('.refresh-btn');\n            btn?.classList.add('spinning');\n            setTimeout(() => {\n                btn?.classList.remove('spinning');\n                isImageLoading.value = false;\n            }, 1000);\n        };\n        const switchCharacter = async (name) => {\n            console.log(`[åˆ‡æ¢] ğŸ’« åˆ‡æ¢è§’è‰²: \"${name}\"`);\n            // è®¾ç½®åŠ è½½çŠ¶æ€\n            isImageLoading.value = true;\n            try {\n                activeChar.value = name;\n                // è·å–æ–°è§’è‰²çš„ç´¢å¼•ï¼Œç”¨äºæ˜ å°„å›¾ç‰‡æ–‡ä»¶å\n                const newIndex = characterNames.value.indexOf(name);\n                const imageKey = mapRoleToImageName(name, newIndex);\n                // æ£€æŸ¥é¢„åŠ è½½ç¼“å­˜ï¼ˆæ”¹ä¸ºæ•°ç»„ï¼‰ï¼Œå¦‚æœå·²é¢„åŠ è½½åˆ™ç›´æ¥ä½¿ç”¨\n                if (preloadCache.value.has(imageKey)) {\n                    const preloadedUrls = preloadCache.value.get(imageKey);\n                    if (preloadedUrls && preloadedUrls.length > 0) {\n                        // åˆå§‹åŒ–æˆ–è·å–å½“å‰ç´¢å¼•\n                        if (!imageIndexMap.value.has(imageKey)) {\n                            // é¦–æ¬¡åˆ‡æ¢åˆ°è¯¥è§’è‰²ï¼Œéšæœºé€‰æ‹©ä¸€å¼ \n                            const randomIndex = Math.floor(Math.random() * preloadedUrls.length);\n                            imageIndexMap.value.set(imageKey, randomIndex);\n                        }\n                        const currentIdx = imageIndexMap.value.get(imageKey) || 0;\n                        currentPhotoUrl.value = preloadedUrls[currentIdx];\n                        console.log(`[åˆ‡æ¢] âš¡ ä½¿ç”¨é¢„åŠ è½½çš„å›¾ç‰‡ï¼Œé›¶å»¶è¿Ÿåˆ‡æ¢å®Œæˆ (å…±${preloadedUrls.length}å¼ ï¼Œæ˜¾ç¤ºç¬¬${currentIdx + 1}å¼ )`);\n                        isImageLoading.value = false;\n                        return;\n                    }\n                }\n                // å¦‚æœæ²¡æœ‰é¢„åŠ è½½ï¼Œåˆ™åŠ è½½æ–°è§’è‰²çš„å›¾ç‰‡\n                await loadCurrentPhoto();\n                console.log(`[åˆ‡æ¢] âœ… åˆ‡æ¢å®Œæˆ: \"${name}\"`);\n            }\n            catch (e) {\n                console.error(`[åˆ‡æ¢] âŒ åˆ‡æ¢å¤±è´¥:`, e);\n            }\n            finally {\n                isImageLoading.value = false;\n                // åˆ‡æ¢è§’è‰²åè°ƒæ•´é«˜åº¦\n                nextTick(adjustHeight);\n            }\n        };\n        const handleImageLoad = () => {\n            isImageLoading.value = false;\n            console.log('[ç…§ç‰‡] âœ… å›¾ç‰‡åŠ è½½æˆåŠŸå¹¶æ˜¾ç¤ºåœ¨é¡µé¢ä¸­');\n            // å›¾ç‰‡åŠ è½½å®Œå¯èƒ½å½±å“é«˜åº¦\n            nextTick(() => setTimeout(adjustHeight, 100));\n        };\n        const handleImageError = (e) => {\n            isImageLoading.value = false;\n            const img = e.target;\n            console.warn('[ç…§ç‰‡] âš ï¸ é¡µé¢å›¾ç‰‡åŠ è½½å¤±è´¥ï¼ˆä½†ç¼“å­˜ä¸­å­˜åœ¨è¯¥å›¾ç‰‡URLï¼‰:', {\n                src: img.src.substring(0, 50) + '...',\n                reason: 'Blob URL å¯èƒ½å·²è¢«é‡Šæ”¾æˆ–æµè§ˆå™¨ç¯å¢ƒå˜åŒ–',\n            });\n            // å°è¯•é‡æ–°åŠ è½½å½“å‰è§’è‰²çš„å›¾ç‰‡\n            // è¿™æ¬¡ä¼šè·³è¿‡é¢„åŠ è½½ç¼“å­˜ï¼Œç›´æ¥ä» CDN ç½‘ç»œåŠ è½½ï¼Œä¸ä¾èµ– IndexedDB\n            const currentIndex = characterNames.value.indexOf(activeChar.value);\n            const imageKey = mapRoleToImageName(activeChar.value, currentIndex);\n            console.log('[ç…§ç‰‡] ğŸ”„ æ¸…é™¤ IndexedDB ç¼“å­˜å¹¶ä»ç½‘ç»œé‡æ–°åŠ è½½...');\n            // åˆ é™¤ IndexedDB ä¸­å¯èƒ½æŸåçš„ç¼“å­˜\n            if (imageDatabase) {\n                const transaction = imageDatabase.transaction(['images'], 'readwrite');\n                const store = transaction.objectStore('images');\n                const deleteRequest = store.delete(imageKey);\n                deleteRequest.onsuccess = () => {\n                    console.log(`[ç…§ç‰‡] ğŸ—‘ï¸ å·²åˆ é™¤ \"${imageKey}\" çš„ç¼“å­˜æ•°æ®`);\n                };\n                deleteRequest.onerror = () => {\n                    console.warn(`[ç…§ç‰‡] âš ï¸ åˆ é™¤ç¼“å­˜å¤±è´¥: ${imageKey}`);\n                };\n            }\n            // ç›´æ¥ä»ç½‘ç»œåŠ è½½ï¼ˆè·³è¿‡ IndexedDBï¼‰\n            loadImagesParallel(imageKey, 0, 30) // åŠ è½½å…¨éƒ¨èŒƒå›´ï¼ˆ0-30ï¼‰\n                .then(blobUrls => {\n                if (blobUrls.length === 0) {\n                    console.error(`[ç…§ç‰‡] âŒ æ— æ³•ä»ç½‘ç»œåŠ è½½ \"${imageKey}\"`);\n                    return;\n                }\n                const randomIndex = Math.floor(Math.random() * blobUrls.length);\n                const selectedUrl = blobUrls[randomIndex];\n                console.log(`[ç…§ç‰‡] âœ… ä»ç½‘ç»œæˆåŠŸåŠ è½½ï¼Œè®¾ç½®ä¸º Blob URL...`);\n                currentPhotoUrl.value = selectedUrl;\n                // æ¸…ç†å…¶ä»–æœªä½¿ç”¨çš„ URL\n                blobUrls.forEach((url, idx) => {\n                    if (idx !== randomIndex) {\n                        URL.revokeObjectURL(url);\n                    }\n                });\n                // å¼‚æ­¥ä¿å­˜åˆ° IndexedDBï¼ˆä¸é˜»å¡ UIï¼‰\n                fetch(selectedUrl)\n                    .then(r => r.blob())\n                    .then(blob => {\n                    if (blob.size > 0) {\n                        console.log(`[ç…§ç‰‡] ğŸ’¾ é‡æ–°ä¿å­˜åˆ° IndexedDB...`);\n                        saveImageToDB(imageKey, blob);\n                    }\n                })\n                    .catch(err => console.warn('[ç…§ç‰‡] ä¿å­˜åˆ° IndexedDB å¤±è´¥:', err));\n            })\n                .catch((err) => {\n                console.error('[ç…§ç‰‡] âŒ ä»ç½‘ç»œé‡æ–°åŠ è½½å¤±è´¥:', err);\n            });\n        };\n        const toggleThemeModal = () => {\n            showThemeModal.value = !showThemeModal.value;\n        };\n        const handlePhotoClick = async () => {\n            const imageKey = mapRoleToImageName(activeChar.value, characterNames.value.indexOf(activeChar.value));\n            let info = currentImageInfo.value;\n            let images = info?.images || [];\n            let currentIndex = info?.currentIndex || 0;\n            if (!info || !info.hasMultiple) {\n                const freshUrls = await loadImagesParallel(imageKey, 0, 30).catch(() => []);\n                if (freshUrls && freshUrls.length) {\n                    const merged = Array.from(new Set([...(preloadCache.value.get(imageKey) || []), ...freshUrls]));\n                    preloadCache.value.set(imageKey, merged);\n                    imageIndexMap.value.set(imageKey, imageIndexMap.value.get(imageKey) ?? 0);\n                    images = merged;\n                    currentIndex = imageIndexMap.value.get(imageKey) || 0;\n                    info = {\n                        imageKey,\n                        images,\n                        currentIndex,\n                        total: images.length,\n                        hasMultiple: images.length > 1,\n                    };\n                }\n                else {\n                    console.log('[ç…§ç‰‡] å½“å‰è§’è‰²åªæœ‰ä¸€å¼ å›¾ç‰‡æˆ–æœªåŠ è½½ï¼Œæ— æ³•åˆ‡æ¢');\n                    return;\n                }\n            }\n            const nextIndex = ((currentIndex || 0) + 1) % images.length;\n            imageIndexMap.value.set(imageKey, nextIndex);\n            currentPhotoUrl.value = images[nextIndex];\n            console.log(`[ç…§ç‰‡] ?? åˆ‡æ¢å›¾ç‰‡: ${imageKey} (ç¬¬${nextIndex + 1}/${images.length}å¼ )`);\n            // è§¦å‘ç‚¹å‡»åŠ¨ç”»\n            const photoFrame = document.querySelector('.photo-frame');\n            if (photoFrame) {\n                photoFrame.classList.add('photo-clicked');\n                setTimeout(() => {\n                    photoFrame.classList.remove('photo-clicked');\n                }, 300);\n            }\n        };\n        // --- é«˜åº¦è‡ªé€‚åº”é€»è¾‘ (ä¼˜åŒ–ç‰ˆ) ---\n        const adjustHeight = () => {\n            if (!containerRef.value)\n                return;\n            // ä½¿ç”¨ requestAnimationFrame é¿å…å¸ƒå±€æŠ–åŠ¨\n            requestAnimationFrame(() => {\n                const height = containerRef.value?.scrollHeight || 300;\n                const finalHeight = Math.max(height, 300) + 20; // å¢åŠ ä¸€ç‚¹ç¼“å†²\n                // å‘é€æ¶ˆæ¯ç»™çˆ¶çº§ (é…’é¦†æ‰©å±•æ ‡å‡†åšæ³•)\n                if (window.parent && window.parent !== window) {\n                    window.parent.postMessage({\n                        type: 'adjustIframeHeight',\n                        height: finalHeight,\n                        scriptId: 'status-bar',\n                    }, '*');\n                }\n            });\n        };\n        // ç›‘å¬å™¨\n        let resizeObserver = null;\n        onMounted(async () => {\n            // 1. åˆå§‹åŒ–æ•°æ®\n            fetchData();\n            // 2. æ³¨å†Œäº‹ä»¶ç›‘å¬ (ä½¿ç”¨è§„èŒƒçš„ eventOn)\n            if (typeof eventOn === 'function' && typeof tavern_events !== 'undefined') {\n                // ç›‘å¬æ¶ˆæ¯æ›´æ–°å’Œæ¥æ”¶\n                eventOn(tavern_events.MESSAGE_UPDATED, fetchData);\n                eventOn(tavern_events.MESSAGE_RECEIVED, fetchData);\n                eventOn(tavern_events.CHAT_CHANGED, fetchData);\n            }\n            // 3. å¯åŠ¨é«˜åº¦ç›‘å¬\n            if (containerRef.value && typeof ResizeObserver !== 'undefined') {\n                resizeObserver = new ResizeObserver(() => adjustHeight());\n                resizeObserver.observe(containerRef.value);\n                resizeObserver.observe(document.body); // åŒæ—¶ä¹Ÿç›‘å¬ body å˜åŒ–\n            }\n            // 4. æ¢å¤ä¸»é¢˜\n            document.documentElement.setAttribute('data-theme', currentTheme.value);\n            // 5. ç­‰å¾…æ•°æ®åŠ è½½å®Œæˆåï¼Œå¯åŠ¨æ™ºèƒ½åˆ†æ‰¹é¢„åŠ è½½\n            const unwatch = watch(() => statData.value.è§’è‰², async (newRoles) => {\n                if (newRoles && Object.keys(newRoles).length > 0) {\n                    // ç­‰å¾…è§’è‰²è‡ªåŠ¨é€‰ä¸­å®Œæˆåå†å¯åŠ¨é¢„åŠ è½½\n                    if (activeChar.value) {\n                        // âœ¨ å¯åŠ¨æ™ºèƒ½åˆ†æ‰¹é¢„åŠ è½½ï¼ˆä¸awaitï¼Œä¸é˜»å¡UIï¼‰\n                        smartBatchPreload().catch((e) => {\n                            console.error('[é¢„åŠ è½½] å¯åŠ¨å¤±è´¥:', e);\n                        });\n                        unwatch(); // åªæ‰§è¡Œä¸€æ¬¡\n                    }\n                }\n            }, { immediate: true });\n            // åŒæ—¶ç›‘å¬ activeChar çš„å˜åŒ–ï¼ˆç”¨æˆ·åˆ‡æ¢è§’è‰²æˆ–åˆå§‹åŒ–æ—¶è§¦å‘ï¼‰\n            watch(activeChar, (newChar) => {\n                if (newChar && characterNames.value.length > 0) {\n                    // åˆæ¬¡åŠ è½½è§’è‰²å›¾ç‰‡\n                    loadCurrentPhoto();\n                }\n            });\n        });\n        onUnmounted(() => {\n            if (resizeObserver)\n                resizeObserver.disconnect();\n            // âœ… æ¸…ç†å»¶è¿Ÿé‡Šæ”¾å®šæ—¶å™¨\n            if (releaseTimer) {\n                clearTimeout(releaseTimer);\n                releaseTimer = null;\n            }\n            // âœ… æ¸…ç†å½“å‰æ˜¾ç¤ºçš„ Blob URL\n            if (currentPhotoUrl.value && currentPhotoUrl.value.startsWith('blob:')) {\n                try {\n                    URL.revokeObjectURL(currentPhotoUrl.value);\n                    console.log('[æ¸…ç†] âœ… å·²é‡Šæ”¾å½“å‰æ˜¾ç¤ºçš„ Blob URL');\n                }\n                catch (e) {\n                    console.warn('[æ¸…ç†] âš ï¸ é‡Šæ”¾å½“å‰ Blob URL å¤±è´¥:', e);\n                }\n            }\n            // âœ… æ¸…ç†ä¹‹å‰ä¿å­˜çš„ URL\n            // âœ… æ¸…ç†é¢„åŠ è½½ç¼“å­˜ä¸­çš„ Blob URLï¼Œé˜²æ­¢å†…å­˜æ³„æ¼\n            preloadCache.value.forEach((blobUrl) => {\n                try {\n                    URL.revokeObjectURL(blobUrl);\n                }\n                catch (e) {\n                    console.warn('[æ¸…ç†] âš ï¸ é‡Šæ”¾é¢„åŠ è½½ç¼“å­˜ Blob URL å¤±è´¥:', e);\n                }\n            });\n            preloadCache.value.clear();\n            // âœ… å…³é—­ IndexedDB è¿æ¥\n            if (imageDatabase) {\n                imageDatabase.close();\n                console.log('[æ¸…ç†] å·²å…³é—­ IndexedDB è¿æ¥');\n            }\n            console.log('[æ¸…ç†] å·²é‡Šæ”¾æ‰€æœ‰ Blob URL å’Œèµ„æº');\n        });\n        watch(activeChar, () => {\n            nextTick(adjustHeight);\n        });\n        watch(currentTheme, val => {\n            localStorage.setItem('tavern_helper_theme', val);\n            document.documentElement.setAttribute('data-theme', val);\n            nextTick(adjustHeight);\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"main\", {\n                class: \"glass-container\",\n                \"data-theme\": currentTheme.value,\n                ref_key: \"containerRef\",\n                ref: containerRef\n            }, [\n                _createCommentVNode(\" é¡¶éƒ¨åŠŸèƒ½åŒº \"),\n                _createElementVNode(\"header\", _hoisted_2, [\n                    _createElementVNode(\"div\", { class: \"header-content\" }, [\n                        _cache[6] || (_cache[6] = _createElementVNode(\"h2\", { class: \"section-title\" }, [\n                            _createElementVNode(\"span\", { class: \"icon-pulse\" }, \"ğŸ“Š\"),\n                            _createElementVNode(\"span\", { class: \"title-text\" }, \"çŠ¶æ€ç›‘è§†å™¨\")\n                        ], -1 /* CACHED */)),\n                        _createElementVNode(\"div\", { class: \"header-actions\" }, [\n                            _createElementVNode(\"button\", {\n                                class: \"icon-btn refresh-btn\",\n                                onClick: handleManualRefresh,\n                                title: \"å¼ºåˆ¶åˆ·æ–°æ•°æ®\"\n                            }, [...(_cache[4] || (_cache[4] = [\n                                    _createElementVNode(\"span\", null, \"ğŸ”„\", -1 /* CACHED */)\n                                ]))]),\n                            _createElementVNode(\"button\", {\n                                class: \"icon-btn theme-toggle\",\n                                onClick: toggleThemeModal,\n                                title: \"æ˜¾ç¤ºè®¾ç½®\"\n                            }, [...(_cache[5] || (_cache[5] = [\n                                    _createElementVNode(\"span\", { class: \"gear-icon\" }, \"âš™ï¸\", -1 /* CACHED */)\n                                ]))])\n                        ])\n                    ]),\n                    _createCommentVNode(\" âœ¨ åŠ è½½è¿›åº¦æ¡ \"),\n                    _createVNode(_Transition, { name: \"fade-slide\" }, {\n                        default: _withCtx(() => [\n                            (isPreloading.value || preloadPhase.value)\n                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [\n                                    _createElementVNode(\"div\", _hoisted_4, [\n                                        _cache[7] || (_cache[7] = _createElementVNode(\"span\", { class: \"progress-icon\" }, \"ğŸ“¦\", -1 /* CACHED */)),\n                                        _createElementVNode(\"span\", _hoisted_5, _toDisplayString(preloadPhase.value || 'åŠ è½½ä¸­'), 1 /* TEXT */),\n                                        _createElementVNode(\"span\", _hoisted_6, _toDisplayString(loadingProgress.value) + \" / \" + _toDisplayString(totalImages.value), 1 /* TEXT */)\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_7, [\n                                        _createElementVNode(\"div\", {\n                                            class: \"progress-fill\",\n                                            style: _normalizeStyle({ width: `${(loadingProgress.value / totalImages.value) * 100}%` })\n                                        }, null, 4 /* STYLE */)\n                                    ])\n                                ]))\n                                : _createCommentVNode(\"v-if\", true)\n                        ]),\n                        _: 1 /* STABLE */\n                    }),\n                    _createCommentVNode(\" åŸºç¡€ä¿¡æ¯å¡ç‰‡ \"),\n                    _createElementVNode(\"div\", _hoisted_8, [\n                        _createElementVNode(\"div\", _hoisted_9, [\n                            _createElementVNode(\"div\", _hoisted_10, [\n                                _cache[9] || (_cache[9] = _createElementVNode(\"span\", { class: \"icon\" }, \"ğŸ“–\", -1 /* CACHED */)),\n                                _createElementVNode(\"div\", _hoisted_11, [\n                                    _cache[8] || (_cache[8] = _createElementVNode(\"span\", { class: \"label\" }, \"å½“å‰ç« èŠ‚\", -1 /* CACHED */)),\n                                    _createElementVNode(\"span\", _hoisted_12, _toDisplayString(statData.value.ç« èŠ‚ || 'ç­‰å¾…æ•°æ®...'), 1 /* TEXT */)\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_13, [\n                                _cache[11] || (_cache[11] = _createElementVNode(\"span\", { class: \"icon\" }, \"ğŸ•\", -1 /* CACHED */)),\n                                _createElementVNode(\"div\", _hoisted_14, [\n                                    _cache[10] || (_cache[10] = _createElementVNode(\"span\", { class: \"label\" }, \"ä¸–ç•Œæ—¶é—´\", -1 /* CACHED */)),\n                                    _createElementVNode(\"span\", _hoisted_15, _toDisplayString(statData.value.æ—¶é—´ || 'æœªçŸ¥æ—¶é—´'), 1 /* TEXT */)\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_16, [\n                                _cache[13] || (_cache[13] = _createElementVNode(\"span\", { class: \"icon\" }, \"ğŸ“\", -1 /* CACHED */)),\n                                _createElementVNode(\"div\", _hoisted_17, [\n                                    _cache[12] || (_cache[12] = _createElementVNode(\"span\", { class: \"label\" }, \"å½“å‰åœ°ç‚¹\", -1 /* CACHED */)),\n                                    _createElementVNode(\"span\", _hoisted_18, _toDisplayString(statData.value.å½“å‰åœ°ç‚¹ || 'æœªçŸ¥åœ°ç‚¹'), 1 /* TEXT */)\n                                ])\n                            ])\n                        ]),\n                        _createCommentVNode(\" è§’è‰²ç…§ç‰‡åŒº \"),\n                        _createElementVNode(\"div\", _hoisted_19, [\n                            _createElementVNode(\"div\", {\n                                class: _normalizeClass([\"photo-frame\", {\n                                        'has-photo': currentPhotoUrl.value && imagesLoaded.value,\n                                        loading: isImageLoading.value || !imagesLoaded.value,\n                                    }]),\n                                onClick: handlePhotoClick\n                            }, [\n                                (isImageLoading.value || !imagesLoaded.value)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_20))\n                                    : _createCommentVNode(\"v-if\", true),\n                                (currentPhotoUrl.value)\n                                    ? (_openBlock(), _createElementBlock(\"img\", {\n                                        key: 1,\n                                        src: currentPhotoUrl.value,\n                                        alt: activeChar.value,\n                                        class: \"char-photo\",\n                                        onError: handleImageError,\n                                        onLoad: handleImageLoad\n                                    }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_21))\n                                    : (imagesLoaded.value)\n                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_22, [...(_cache[14] || (_cache[14] = [\n                                                _createElementVNode(\"span\", { class: \"placeholder-icon\" }, \"ğŸ‘¤\", -1 /* CACHED */),\n                                                _createElementVNode(\"span\", { class: \"placeholder-text\" }, \"NO IMAGE\", -1 /* CACHED */)\n                                            ]))]))\n                                        : (_openBlock(), _createElementBlock(\"div\", _hoisted_23, [...(_cache[15] || (_cache[15] = [\n                                                _createElementVNode(\"span\", { class: \"placeholder-icon\" }, \"â³\", -1 /* CACHED */),\n                                                _createElementVNode(\"span\", { class: \"placeholder-text\" }, \"LOADING...\", -1 /* CACHED */)\n                                            ]))]))\n                            ], 2 /* CLASS */),\n                            _createElementVNode(\"div\", _hoisted_24, [\n                                _createElementVNode(\"span\", _hoisted_25, _toDisplayString(cleanCharName(activeChar.value || 'æœªçŸ¥è§’è‰²')), 1 /* TEXT */),\n                                _createElementVNode(\"span\", {\n                                    class: _normalizeClass([\"char-status-dot\", { active: hasCharacters.value }])\n                                }, null, 2 /* CLASS */),\n                                _createCommentVNode(\" âœ¨ å›¾ç‰‡è®¡æ•°æ˜¾ç¤º \"),\n                                (currentImageInfo.value && currentImageInfo.value.hasMultiple)\n                                    ? (_openBlock(), _createElementBlock(\"span\", {\n                                        key: 0,\n                                        class: \"image-counter\",\n                                        title: `ç‚¹å‡»å›¾ç‰‡åˆ‡æ¢ï¼ˆå…±${currentImageInfo.value.total}å¼ ï¼‰`\n                                    }, _toDisplayString(currentImageInfo.value.currentIndex + 1) + \"/\" + _toDisplayString(currentImageInfo.value.total), 9 /* TEXT, PROPS */, _hoisted_26))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ])\n                        ])\n                    ])\n                ]),\n                _createCommentVNode(\" è§’è‰²è¯¦æƒ…åŒº \"),\n                _createElementVNode(\"section\", _hoisted_27, [\n                    _createCommentVNode(\" è¯¦æƒ…å†…å®¹ \"),\n                    _createVNode(_Transition, {\n                        name: \"fade-slide\",\n                        mode: \"out-in\"\n                    }, {\n                        default: _withCtx(() => [\n                            (activeCharData.value)\n                                ? (_openBlock(), _createElementBlock(\"div\", {\n                                    key: activeChar.value,\n                                    class: \"tab-content\"\n                                }, [\n                                    _createElementVNode(\"div\", _hoisted_28, [\n                                        _createCommentVNode(\" äººç‰©é€‰æ‹©å¡ç‰‡ - å…¨å®½ \"),\n                                        _createElementVNode(\"div\", _hoisted_29, [\n                                            _cache[16] || (_cache[16] = _createElementVNode(\"h3\", null, \"ğŸ‘¥ äººç‰©é€‰æ‹©\", -1 /* CACHED */)),\n                                            _createElementVNode(\"nav\", _hoisted_30, [\n                                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(cleanedCharacterNames.value, (cleanName, index) => {\n                                                    return (_openBlock(), _createElementBlock(\"button\", {\n                                                        key: characterNames.value[index],\n                                                        class: _normalizeClass([\"tab-button\", { active: characterNames.value[index] === activeChar.value }]),\n                                                        onClick: ($event) => (switchCharacter(characterNames.value[index]))\n                                                    }, [\n                                                        _createTextVNode(_toDisplayString(cleanName) + \" \", 1 /* TEXT */),\n                                                        _createCommentVNode(\" âœ… æ˜¾ç¤ºæ¸…ç†åçš„åå­— \")\n                                                    ], 10 /* CLASS, PROPS */, _hoisted_31));\n                                                }), 128 /* KEYED_FRAGMENT */))\n                                            ])\n                                        ]),\n                                        _createCommentVNode(\" å¿ƒç†ä¸å§¿æ€ (å…¨å®½) \"),\n                                        (activeCharData.value.å½“å‰æƒ³æ³•)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_32, [\n                                                _cache[17] || (_cache[17] = _createElementVNode(\"h3\", null, \"ğŸ’­ å†…å¿ƒæƒ³æ³•\", -1 /* CACHED */)),\n                                                _createElementVNode(\"div\", _hoisted_33, _toDisplayString(activeCharData.value.å½“å‰æƒ³æ³•), 1 /* TEXT */)\n                                            ]))\n                                            : _createCommentVNode(\"v-if\", true),\n                                        (activeCharData.value.å§¿åŠ¿)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_34, [\n                                                _cache[18] || (_cache[18] = _createElementVNode(\"h3\", null, \"ğŸƒ å½“å‰å§¿æ€\", -1 /* CACHED */)),\n                                                _createElementVNode(\"div\", _hoisted_35, _toDisplayString(activeCharData.value.å§¿åŠ¿), 1 /* TEXT */)\n                                            ]))\n                                            : _createCommentVNode(\"v-if\", true),\n                                        _createCommentVNode(\" åŸºç¡€å±æ€§ \"),\n                                        _createElementVNode(\"div\", _hoisted_36, [\n                                            _cache[19] || (_cache[19] = _createElementVNode(\"h3\", null, \"ğŸ“‹ çŠ¶æ€é¢æ¿\", -1 /* CACHED */)),\n                                            _createElementVNode(\"div\", _hoisted_37, [\n                                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(basicInfo.value, (val, key) => {\n                                                    return (_openBlock(), _createElementBlock(\"div\", {\n                                                        class: \"detail-item\",\n                                                        key: key\n                                                    }, [\n                                                        _createElementVNode(\"span\", _hoisted_38, _toDisplayString(key.replace(/^[^\\u4e00-\\u9fa5]+/, '')), 1 /* TEXT */),\n                                                        _createElementVNode(\"span\", _hoisted_39, _toDisplayString(val || '--'), 1 /* TEXT */)\n                                                    ]));\n                                                }), 128 /* KEYED_FRAGMENT */))\n                                            ])\n                                        ]),\n                                        _createCommentVNode(\" å¤–è§‚ç‰¹å¾ \"),\n                                        _createElementVNode(\"div\", _hoisted_40, [\n                                            _cache[20] || (_cache[20] = _createElementVNode(\"h3\", null, \"ğŸ‘¤ å¤–è§‚ç‰¹å¾\", -1 /* CACHED */)),\n                                            _createElementVNode(\"div\", _hoisted_41, [\n                                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(appearanceInfo.value, (val, key) => {\n                                                    return (_openBlock(), _createElementBlock(\"div\", {\n                                                        class: \"appearance-item\",\n                                                        key: key\n                                                    }, [\n                                                        _createElementVNode(\"div\", _hoisted_42, _toDisplayString(key.replace(/^[^\\u4e00-\\u9fa5]+/, '')), 1 /* TEXT */),\n                                                        _createElementVNode(\"div\", _hoisted_43, _toDisplayString(val || '--'), 1 /* TEXT */)\n                                                    ]));\n                                                }), 128 /* KEYED_FRAGMENT */))\n                                            ])\n                                        ])\n                                    ])\n                                ]))\n                                : (_openBlock(), _createElementBlock(\"div\", _hoisted_44, [\n                                    _cache[21] || (_cache[21] = _createElementVNode(\"div\", { class: \"empty-icon\" }, \"ğŸ“¡\", -1 /* CACHED */)),\n                                    (!imagesLoaded.value)\n                                        ? (_openBlock(), _createElementBlock(\"p\", _hoisted_45, \"åŠ è½½ä¸­...\"))\n                                        : (_openBlock(), _createElementBlock(\"p\", _hoisted_46, \"è¯·é€‰æ‹©ä¸€ä¸ªè§’è‰²\")),\n                                    (!imagesLoaded.value)\n                                        ? (_openBlock(), _createElementBlock(\"small\", _hoisted_47, \"æ­£åœ¨åŒæ­¥é…’é¦†æ•°æ®\"))\n                                        : (_openBlock(), _createElementBlock(\"small\", _hoisted_48, \"ç‚¹å‡»ä¸Šæ–¹é€‰é¡¹å¡æŸ¥çœ‹è§’è‰²ä¿¡æ¯\"))\n                                ]))\n                        ]),\n                        _: 1 /* STABLE */\n                    })\n                ]),\n                _createCommentVNode(\" è®¾ç½®å¼¹çª— \"),\n                _createVNode(_Transition, { name: \"fade\" }, {\n                    default: _withCtx(() => [\n                        (showThemeModal.value)\n                            ? (_openBlock(), _createElementBlock(\"div\", {\n                                key: 0,\n                                class: \"modal-overlay\",\n                                onClick: _cache[3] || (_cache[3] = ($event) => (showThemeModal.value = false))\n                            }, [\n                                _createElementVNode(\"div\", {\n                                    class: \"modal-content glass-panel\",\n                                    onClick: _cache[2] || (_cache[2] = _withModifiers(() => { }, [\"stop\"]))\n                                }, [\n                                    _createElementVNode(\"div\", _hoisted_49, [\n                                        _cache[22] || (_cache[22] = _createElementVNode(\"h3\", null, \"ç•Œé¢è®¾ç½®\", -1 /* CACHED */)),\n                                        _createElementVNode(\"button\", {\n                                            class: \"btn-close\",\n                                            onClick: _cache[0] || (_cache[0] = ($event) => (showThemeModal.value = false))\n                                        }, \"Ã—\")\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_50, [\n                                        _cache[24] || (_cache[24] = _createElementVNode(\"label\", null, \"ğŸ¨ ä¸»é¢˜é£æ ¼\", -1 /* CACHED */)),\n                                        _withDirectives(_createElementVNode(\"select\", {\n                                            \"onUpdate:modelValue\": _cache[1] || (_cache[1] = ($event) => ((currentTheme).value = $event))\n                                        }, [...(_cache[23] || (_cache[23] = [\n                                                _createElementVNode(\"option\", { value: \"default\" }, \"âœ¨ æå…‰ç»ç’ƒ (é»˜è®¤)\", -1 /* CACHED */),\n                                                _createElementVNode(\"option\", { value: \"dark\" }, \"ğŸŒ‘ æ·±ç©ºå¹½è“\", -1 /* CACHED */),\n                                                _createElementVNode(\"option\", { value: \"classic_vintage\" }, \"ğŸ“œ ç¾Šçš®å·è½´\", -1 /* CACHED */)\n                                            ]))], 512 /* NEED_PATCH */), [\n                                            [_vModelSelect, currentTheme.value]\n                                        ])\n                                    ])\n                                ])\n                            ]))\n                            : _createCommentVNode(\"v-if\", true)\n                    ]),\n                    _: 1 /* STABLE */\n                })\n            ], 8 /* PROPS */, _hoisted_1));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./App.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./App.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./App.vue?vue&type=style&index=0&id=e5e0b8ce&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_53ff6257bd8fdf8315af10a81f7e3da1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-e5e0b8ce\"]])\n\nexport default __exports__","import { createApp } from 'vue';\nimport App from './App.vue';\nimport './index.scss';\n\n$(() => {\n  const mountPoint = document.getElementById('app');\n\n  // âœ… é˜²é‡å¤æŒ‚è½½ï¼šæ£€æŸ¥æ˜¯å¦å·²ç»åŠ è½½è¿‡çŠ¶æ€æ \n  if (sessionStorage.getItem('status_bar_loaded')) {\n    console.log('[çŠ¶æ€æ ] å·²å­˜åœ¨ï¼Œè·³è¿‡é‡å¤åŠ è½½');\n    return;\n  }\n\n  if (mountPoint) {\n    const app = createApp(App);\n    app.mount(mountPoint);\n\n    // âœ… æ ‡è®°ä¸ºå·²åŠ è½½\n    sessionStorage.setItem('status_bar_loaded', 'true');\n\n    console.log('LingDong: Vue App Mounted Successfully.');\n\n    // ä¸¥æ ¼éµå¾ªè§„èŒƒï¼šä½¿ç”¨ pagehide æ¸…ç†èµ„æº\n    $(window).on('pagehide', () => {\n      app.unmount();\n      console.log('LingDong: Vue App Unmounted.');\n      // âœ… æ¸…ç†æ ‡è®°\n      sessionStorage.removeItem('status_bar_loaded');\n    });\n  } else {\n    console.error('LingDong: Mount point #app not found!');\n  }\n});\n"],"names":["exports","sfc","props","target","__vccOpts","key","val","__webpack_module_cache__","Vue","_hoisted_1","_hoisted_2","class","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_49","_hoisted_50","__name","setup","__props","loadImagesParallel","async","roleName","rangeStart","rangeEnd","onProgress","cdnMirrors","lastError","cdnPrefix","console","log","imageUrls","push","url","encodeURIComponent","name","i","Math","max","rangeDesc","results","Promise","allSettled","map","result","loadImageAsBlob","blobUrls","failedCount","forEach","index","status","value","length","error","warn","message","fileName","resolve","fetch","mode","then","response","ok","Error","blob","blobUrl","URL","createObjectURL","catch","initImageDatabase","reject","request","indexedDB","open","onerror","onsuccess","db","onupgradeneeded","event","objectStoreNames","contains","createObjectStore","keyPath","e","imageDatabase","saveImageToDB","transaction","objectStore","put","getImageFromCache","cachedBlob","get","size","toFixed","getImageFromDB","randomIndex","floor","random","selectedImageUrl","savePromise","r","revokeObjectURL","containerRef","ref","statData","activeChar","showThemeModal","currentTheme","localStorage","getItem","isImageLoading","loadingProgress","totalImages","isPreloading","preloadPhase","characterNames","computed","Object","keys","hasCharacters","currentImageInfo","currentIndex","indexOf","imageKey","mapRoleToImageName","images","preloadCache","imageIndexMap","total","hasMultiple","initializationComplete","imagesLoaded","currentPhotoUrl","cleanedCharacterNames","cleanCharName","activeCharData","data","trim","roleIndex","releaseTimer","watch","newUrl","oldUrl","clearTimeout","startsWith","setTimeout","substring","Map","preloadCharacterImages","imageName","loaded","existingUrls","set","loadCurrentPhoto","targetChar","has","preloadedUrls","currentIdx","imageUrl","cachedList","includes","urls","merged","Array","from","Set","basicInfo","appearanceInfo","fetchData","hasGetCurrent","getCurrentMessageId","hasGetLast","getLastMessageId","getChatMessages","targetMsg","msgId","msgs","lastId","stat_data","nextTick","adjustHeight","handleManualRefresh","btn","document","querySelector","classList","add","remove","handleImageLoad","handleImageError","img","src","reason","deleteRequest","delete","selectedUrl","idx","err","toggleThemeModal","handlePhotoClick","info","freshUrls","nextIndex","photoFrame","requestAnimationFrame","height","scrollHeight","finalHeight","window","parent","postMessage","type","scriptId","resizeObserver","onMounted","eventOn","tavern_events","MESSAGE_UPDATED","MESSAGE_RECEIVED","CHAT_CHANGED","ResizeObserver","observe","body","documentElement","setAttribute","unwatch","newRoles","charCount","lufuIndex","lufuImageName","charName","smartBatchPreload","immediate","newChar","onUnmounted","disconnect","clear","close","setItem","_ctx","_cache","ref_key","onClick","title","default","style","width","_","loading","alt","onError","onLoad","active","cleanName","$event","newIndex","replace","__webpack_require__","moduleId","cachedModule","undefined","module","__webpack_modules__","$","mountPoint","getElementById","sessionStorage","app","createApp","App","mount","on","unmount","removeItem"],"ignoreList":[],"sourceRoot":""}