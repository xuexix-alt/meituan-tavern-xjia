var e={919:()=>{$(()=>{toastr.success('前端占位符检查脚本已加载!','脚本启动')}),$(window).on('pagehide',()=>{toastr.info('前端占位符检查脚本已卸载!','脚本关闭')})}},t={};(function o(s){var n=t[s];if(void 0!==n)return n.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,o),a.exports})(919);async function o(e,t='auto'){try{const o='auto'===t?'自动':'手动';if(console.log(`[前端占位符] ${o}检查第 ${e} 楼消息`),'number'!=typeof e||e<0)return void console.log(`[前端占位符] 无效的消息ID: ${e}`);let s;try{s=getChatMessages(e.toString())}catch(t){console.log(`[前端占位符] 消息ID ${e} 超出范围，尝试获取最新消息`),s=getChatMessages(-1),s&&s.length>0&&(e=s[0].message_id,console.log(`[前端占位符] 改为${o}检查最新消息第 ${e} 楼`))}if(!s||0===s.length)return void console.log('[前端占位符] 无法获取消息内容');const n=s[0],a='【前端占位符】';if(n.message.includes(a))console.log(`[前端占位符] 第 ${e} 楼已包含占位符，跳过${o}添加`);else{const s=n.message+'\n'+a;await setChatMessages([{message_id:e,message:s}]),'auto'===t?toastr.success('自动添加界面成功！','自动检测完成'):toastr.success('手动添加界面成功！','手动操作完成'),console.log(`[前端占位符] ${o}已在第 ${e} 楼添加占位符`)}}catch(o){const s='auto'===t?'自动':'手动';toastr.error(`${s}处理第 ${e} 楼消息时出错: ${o}`,`${s}操作失败`),console.error(`[前端占位符] ${s}处理第 ${e} 楼消息时出错:`,o)}}eventOn(tavern_events.GENERATION_ENDED,async e=>{setTimeout(async()=>{await o(e)},100)}),$(()=>{replaceScriptButtons([{name:'检查占位符',visible:!0}]),eventOn(getButtonEvent('检查占位符'),async()=>{toastr.info('正在检查最新消息的占位符...','检查中'),await async function(){try{console.log('[前端占位符] 手动检查最新消息');const e=getLastMessageId();if(console.log(`[前端占位符] 获取到最新消息ID: ${e}`),0===e)return void toastr.warning('当前聊天没有消息','提示');await o(e,'manual')}catch(e){toastr.error(`获取最新消息时出错: ${e}`,'手动操作失败'),console.error('[前端占位符] 获取最新消息时出错:',e)}}()})});
//# sourceMappingURL=index.js.map