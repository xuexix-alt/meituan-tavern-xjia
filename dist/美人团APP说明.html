<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>💄 美人团 APP 系统 (Ver 3.0.0 beta2)</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'PingFang SC', 'Microsoft YaHei', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.8;
      color: #2c3e50;
      background: #ffffff;
      padding: 0;
      width: 100%;
      margin: 0;
      transition: all 0.3s ease;
    }

    /* 深色模式适配 */
    [data-theme='dark'] body {
      color: #ffffff;
      background: #1a1a1a;
    }

    .container {
      background: #ffffff;
      border-radius: 0;
      padding: 20px;
      box-shadow: none;
      border: none;
      position: relative;
      overflow: hidden;
      width: 100%;
      min-height: auto;
    }

    [data-theme='dark'] .container {
      background: #2d2d2d;
    }

    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 195, 0, 0.03), transparent);
      transition: left 0.6s ease;
    }

    .container:hover::before {
      left: 100%;
    }

    h1 {
      font-size: 2.2em;
      font-weight: 800;
      background: linear-gradient(135deg, var(--accent-primary, #ffc300) 0%, var(--accent-dark, #e6b000) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 20px;
      text-align: center;
      position: relative;
      padding: 20px 0;
    }

    h1::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 3px;
      background: linear-gradient(90deg, transparent, var(--accent-primary, #ffc300), transparent);
      border-radius: 2px;
    }

    h2 {
      font-size: 1.5em;
      color: #d97706;
      margin: 30px 0 15px 0;
      padding: 10px 0;
      border-left: 4px solid #f59e0b;
      padding-left: 15px;
      background: rgba(245, 158, 11, 0.1);
      border-radius: 0 8px 8px 0;
    }

    [data-theme='dark'] h2 {
      color: #fbbf24;
      background: rgba(251, 191, 36, 0.15);
    }

    h3 {
      font-size: 1.2em;
      color: #2c3e50;
      margin: 20px 0 10px 0;
      font-weight: 600;
    }

    [data-theme='dark'] h3 {
      color: #ffffff;
    }

    p {
      margin-bottom: 15px;
      color: #4b5563;
    }

    [data-theme='dark'] p {
      color: #e5e7eb;
    }

    blockquote {
      background: rgba(245, 158, 11, 0.1);
      border-left: 4px solid #f59e0b;
      padding: 15px 20px;
      margin: 20px 0;
      border-radius: 0 8px 8px 0;
      font-style: italic;
      position: relative;
      color: #374151;
    }

    [data-theme='dark'] blockquote {
      background: rgba(251, 191, 36, 0.15);
      color: #e5e7eb;
    }

    blockquote::before {
      content: '💡';
      position: absolute;
      top: -5px;
      left: 10px;
      font-size: 1.2em;
    }

    .warning-box {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.1) 100%);
      border: 2px solid #dc2626;
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      position: relative;
    }

    .warning-box::before {
      content: '⚠️';
      position: absolute;
      top: -10px;
      left: 20px;
      font-size: 1.5em;
      background: #ffffff;
      padding: 0 10px;
    }

    [data-theme='dark'] .warning-box::before {
      background: #2d2d2d;
    }

    .warning-box strong {
      color: #dc2626;
      font-size: 1.1em;
    }

    [data-theme='dark'] .warning-box strong {
      color: #f87171;
    }

    ul, ol {
      margin: 15px 0;
      padding-left: 25px;
    }

    li {
      margin-bottom: 8px;
      color: #4b5563;
      position: relative;
    }

    [data-theme='dark'] li {
      color: #e5e7eb;
    }

    li::marker {
      color: #f59e0b;
      font-weight: bold;
    }

    .update-item {
      background: #f9fafb;
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
      border-left: 3px solid #f59e0b;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      transition: all 0.3s ease;
    }

    [data-theme='dark'] .update-item {
      background: #374151;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
    }

    .update-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
    }

    [data-theme='dark'] .update-item:hover {
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);
    }

    .emoji {
      font-size: 1.2em;
      margin-right: 8px;
    }

    .plugin-link {
      background: linear-gradient(135deg, var(--accent-primary, #ffc300) 0%, var(--accent-dark, #e6b000) 100%);
      color: white;
      padding: 8px 16px;
      border-radius: 8px;
      text-decoration: none;
      display: inline-block;
      margin: 5px 0;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(255, 195, 0, 0.3);
    }

    .plugin-link:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 195, 0, 0.4);
    }

    .version-badge {
      display: inline-block;
      background: #f59e0b;
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: 600;
      margin-left: 10px;
    }

    @media (max-width: 768px) {
      body {
        padding: 0;
      }

      .container {
        padding: 15px;
      }

      h1 {
        font-size: 1.8em;
      }

      h2 {
        font-size: 1.3em;
      }
    }

    /* 动画效果 */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .container > * {
      animation: fadeInUp 0.6s ease-out;
    }

    .container > *:nth-child(2) { animation-delay: 0.1s; }
    .container > *:nth-child(3) { animation-delay: 0.2s; }
    .container > *:nth-child(4) { animation-delay: 0.3s; }
    .container > *:nth-child(5) { animation-delay: 0.4s; }
  </style>
</head>
<body>
  <div class="container">
    <h1>💄 美人团 APP 系统 <span class="version-badge" style="color: white;">ver3.0.0</span></h1>

    <blockquote>
      <strong>满足你一切现实与"不现实"的幻想</strong><br>
      这不仅仅是一个平台，更是一个由你的创意主宰的高自由度沙盒。在这里，你可以探索 NTR、NRL、露出等各种玩法，定制一切你能想到的美人商品。剧情与玩法的上限，取决于你的想象力。
    </blockquote>

    <div class="warning-box">
      <p><strong>核心前置：本系统高度依赖"酒馆助手"插件</strong></p>
      <p>请务必先安装插件，否则无法正常运行。</p>
      <p><strong>插件地址：</strong> <a href="https://gitlab.com/novi028/JS-Slash-Runner.git" class="plugin-link">🔗 酒馆助手插件</a></p>
    </div>

    <h2><span class="emoji">💡</span>玩法指南 & 避坑手册</h2>

    <h3><span class="emoji">🛠️</span>一、常见问题排查 (必读)</h3>
    <p>如果遇到加载失败或截断，请按以下顺序检查：</p>

    <ol>
      <li><strong>基础设置：</strong> 务必开启<strong>流式输出 (Stream)</strong>，预设正文回复长度建议设置<strong>不低于 2000 字</strong>。</li>
      <li><strong>模式切换：</strong> 如果世界书导致截断，尝试切换生成模式（YAML 或 JSON 两种格式），总有一种适合你的模型。</li>
      <li><strong>加载顺序自检：</strong>
        <ul>
          <li>✅ 是否安装并启用了"酒馆助手"？</li>
          <li>✅ AI 输出标签中是否包含 <code>&lt;StatusPlaceHolderImpl/&gt;</code>？</li>
          <li>✅ MVUbeta 脚本及角色卡自带脚本是否已加载并开启？</li>
          <li>✅ 角色卡正则脚本是否开启？</li>
          <li>✅ 预设正则是否存在冲突/干扰？</li>
        </ul>
      </li>
      <li><strong>玄学时刻：</strong> 如果以上全没问题但依然无法加载，可能是模型"水土不服"或网络波动。建议稍后重试，我会持续实时更新前端，优化兼容性。</li>
    </ol>

    <h3><span class="emoji">🏠</span>二、首页与性能优化</h3>
    <p><strong>关于截断与卡顿：</strong></p>
    <ul>
      <li><strong>前端轻量化：</strong> 目前通过 CDN 加载的前端资源仅 300K，远小于一张美化 CSS 图片，理论上不会造成卡顿。</li>
      <li><strong>渲染优化：</strong> 如果感觉微卡，请在正则设置或酒馆助手设置中限制渲染楼层（例如设置为 3 层）。</li>
      <li><strong>手动修正：</strong> 若输出被截断，点击酒馆的"继续"，手动删除中间多余内容，保留相对完整的结构即可加载店铺。店铺一旦加载成功会被持久化缓存，不影响后续游玩。</li>
      <li><strong>模型推荐：</strong> 推荐使用 <strong>DeepSeek</strong> 等逻辑性强且不易破限截断的模型，可先生成好菜单再慢慢游玩。</li>
    </ul>

    <p><strong>关于搜索：</strong></p>
    <ul>
      <li>搜索时指令越清晰越好（如："推荐 X 个店铺，包含 X 个套餐"）。</li>
      <li>搜索特定人物（如女明星 XXX）时，请提供基本的身份标识，帮助 AI 识别。</li>
    </ul>

    <h3><span class="emoji">📝</span>三、备注系统（高阶玩法）</h3>
    <ul>
      <li><strong>最高优先级：</strong> 下单时的"备注"拥有最高权重。</li>
      <li><strong>定制服务：</strong> 任何想实现的特殊玩法（色色、剧情走向等），请直接写在备注里，服务过程将严格围绕你的备注展开。</li>
    </ul>

    <h2><span class="emoji">🚀</span>更新日志 (v3.0.0 beta2)</h2>

    <p>本次更新为预览版，重点增强了稳定性与客户端体验。</p>

    <div class="update-item">
      <h3><span class="emoji">🛡️</span>1. 核心优化：多重防截断机制</h3>
      <ul>
        <li><strong>逻辑更健壮：</strong> 即使当前生成内容被意外截断，系统也能从残存文本中提取有效店铺信息，拒绝"挂一漏万"。</li>
        <li><strong>店铺持久化缓存：</strong>
          <ul>
            <li>一次生成，长期有效。系统会自动保存当前搜索到的店铺。</li>
            <li><em>说明：最多缓存 10 个店铺，满额后自动新旧替换，方便随时"光顾"。</em></li>
          </ul>
        </li>
        <li><strong>双模式生成：</strong>
          <ul>
            <li><strong>YAML 模式（推荐）：</strong> 描述含蓄，生成极其稳定。</li>
            <li><strong>JSON 模式：</strong> 描述露骨，但在低 Token 限制下较易截断。</li>
          </ul>
        </li>
        <li><strong>手写文本库植入：</strong> 作者亲自手写了 <code>image</code> 和 <code>description</code> 文本库，有效去除"AI 味"，内容更劲爆，同时大幅降低截断风险。</li>
        <li><strong>变量自动恢复 (Beta)：</strong> 新增容错机制。若当前变量解析失败，系统自动回滚至最近一次有效变量，防止页面空白。</li>
      </ul>
    </div>

    <div class="update-item">
      <h3><span class="emoji">🎮</span>2. 玩法补强</h3>
      <ul>
        <li><strong>世界书增强：</strong> 优化了服务流程指导，现在的剧情推进更有设计感。（<em>Tip：喜欢高自由度自主行动的玩家，请在下单备注中注明</em>）。</li>
        <li><strong>系统联动升级：</strong> 重新装载了 <strong>怀孕系统、折扣系统、认知系统</strong>。
          <ul>
            <li><em>注意：三者联动依赖变量系统的成功解析，若变量更新失败，联动功能将暂时失效。</em></li>
          </ul>
        </li>
      </ul>
    </div>

    <div class="update-item">
      <h3><span class="emoji">📱</span>3. 客户端重构</h3>
      <ul>
        <li><strong>PAD 版界面上线：</strong> 升级为自适应大屏显示，视觉体验更舒适（默认启用）。
          <ul>
            <li><em>注：怀念原手机版界面的用户请反馈，后续考虑增加切换开关。</em></li>
          </ul>
        </li>
        <li><strong>指令精准化：</strong> 补全了界面导航按钮与搜索指令。现在系统会向 AI 精确发送需生成的店铺数与套餐数，减少逻辑错乱。</li>
        <li><strong>信息栏更新：</strong> 首页新增公告栏、说明文档及版本号显示。</li>
      </ul>
    </div>
  </div>
</body>
</html>