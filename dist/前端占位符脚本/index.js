const t=z,e=t.z.object({enabled:t.z.boolean().default(!0),placeholder_text:t.z.string().default('【前端占位符】'),auto_insert:t.z.boolean().default(!0),show_notification:t.z.boolean().default(!0)}),n=e.parse(getVariables({type:'script',script_id:getScriptId()}));function o(t){return t.includes(n.placeholder_text)}function r(){try{const t=function(){const t=getCurrentMessageId(),e=getChatMessages(t);return e&&0!==e.length?e.map(t=>({role:t.role,content:t.message||'',id:t.id})):[]}();if(0===t.length)return console.log('[前端占位符] 当前楼层无消息内容'),!1;if(t.every(t=>o(t.content)))return console.log('[前端占位符] 当前楼层已包含占位符，跳过插入'),!1;if(n.auto_insert){const e=t.map(t=>{return{...t,content:o(t.content)?t.content:(e=t.content,e.endsWith('\n')?e+n.placeholder_text+'\n':e+'\n'+n.placeholder_text+'\n')};var e}),r=t[0].id,s=e.map(t=>`${'user'===t.role?'你':t.role}: ${t.content}`).join('\n\n');return triggerSlash(`/chat u ${r} ${s}`),n.show_notification&&toastr.success('[前端占位符] 已自动插入占位符','脚本提示'),console.log('[前端占位符] 已插入占位符到当前楼层'),!0}return!1}catch(t){return console.error('[前端占位符] 执行失败:',t),toastr.error('前端占位符插入失败，请查看控制台','脚本错误'),!1}}function s(t){const e={...n,...t};replaceVariables(e,{type:'script',script_id:getScriptId()}),n.show_notification&&toastr.success('设置已更新','脚本提示')}function c(){return e.parse(getVariables({type:'script',script_id:getScriptId()}))}$(()=>{console.log('[前端占位符] 脚本已加载'),n.show_notification&&toastr.info('点击下方"检查占位符"按钮手动执行，或启用自动插入模式','脚本提示')}),eventOn(getButtonEvent('检查占位符'),()=>{console.log('[前端占位符] 手动检查触发'),!r()&&n.show_notification&&toastr.info('当前楼层已包含占位符，无需插入','脚本提示')}),eventOn(tavern_events.MESSAGE_SENT,t=>{n.auto_insert&&n.enabled&&(console.log('[前端占位符] 消息发送完成，自动检查'),setTimeout(()=>{r()},100))}),eventOn(tavern_events.CHAT_CHANGED,t=>{console.log('[前端占位符] 聊天切换到:',t)}),$(window).on('pagehide',()=>{console.log('[前端占位符] 脚本已卸载')});export{c as getSettings,s as updateSettings};
//# sourceMappingURL=index.js.map