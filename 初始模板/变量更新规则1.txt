----
正文结束之后，应当依照正文所产生的剧情或变量自身的设定进行以下变量更新操作：
----
MVU变量更新前的思考:
  description: |-
    务必在MVU变量更新前，在后台完成<status_think>思考，再进行变量操作。
  status_think:
    1. 当前系统处于何种状态：1）用户明确指令触发；2）变量本次性交次数达到2主动触发；3）剧情需要触发
      a. 如果是**搜索店铺**，在生成店铺列表时停止任何变量操作和更新，因此跳过以下执行步骤。
      b. 如果是**下单某套餐**：
             - 应识别该订单套餐属于**复购**还是**创建**，创建的话在‘服务中的订单[index]’中赋予一个新的[index]值，比如不同订单对应不同的值如：[1]/[2]/[3]/[4]。如果是复购订单，依照id对应的[index]值准确找到订单变量，在对应变量上依照变量更新规则进行操作，**不创建**新订单数组。
             - 初值内容：
                        1）创建新订单时赋予初始值应符合剧情设定，特别是服装、性经历、心理状态应参考套餐的description、image字段，不ooc   
                        2）复购时要根据当前情形，给女孩服装和身体特征各字段适当重置，以对应更新服装、身体特征，必要时重新赋予新值。（比如服务结束后，女孩再次被复购不能仍然裸着、不能仍然私处红肿）
             - 下单时做好经济系统的变更：账户余额变动。
                       1）全新订单是扣除套餐价格。
                       2）如果是复购订单扣除的是折后价格。**当折后价格为负数时**视为“返现”，增加对应的余额。
              - 下单时订单消费进行累计消费，增加值为对应余额变动值，“返现”时不累计。
              -  复购订单做好相应的折扣计算按规则进行变量操作。
      c. 如果是订单**服务中**：
             - 由于存在多人服务的设定，所以应准确查找当前当前存在几个服务中的订单，并依次按照订单的[index]值对应做好每个订单的变量更新。
             - 在更新时，应思考订单中服装、心理状态、身体特征等随剧情发生的变化，即便未在示例中明示，也应当根据逻辑进行推演，不得遗漏，并准确执行变量更新规则。
             - 更新性经历，包含是否破处及其初次性行为对象更新、性伴侣数量是否需要增加（凡是上过她的都算性伴侣，特别是user）、内射后怀孕几率增加
             - 做好服务统计，每发生一次性交加1，每内射一次加1。
             - 任何服务中的订单本次服务性交次数达到2或以上，应该在正文剧情中触发“服务结束”剧情，如果本轮对话来不及，留到下轮对话（下轮对话优先处理）。
             - 如果有人因触发上一条逻辑即性交次数达到2而触发“结束服务”，则应对照结束服务的规则额外增加对应的变量操作。
      d.如果是订单**结束服务**：
             - 变量‘服务中’变更为‘服务结束’（只有这两种状态）
             - 根据规则做好变量结算：重置本次服务性交次数、内射次数，按规则计算折扣，变更折后价格
             - 根据怀孕几率做好怀孕事件结算。（怀孕几率大于80%触发结算：roll[1-10]随机数，结果为偶数就触发成功）在正文中演绎怀孕事件。
             - 怀孕几率达到100%直接引发怀孕事件。在正文中演绎怀孕事件。
    2. 当前变量做如何操作：
      应当准确思考format: |-示例的创建新订单/服务中/服务结束/再次下单（复购）情形，并仔细参阅变量更新规则进行变量操作，准确查找订单的[index]，不得遗漏。
    3. 当前存在几个订单，他们分别出于服务中还是服务结束，根据剧情需要应对哪几个订单进行对应操作。
      a. 如未达到结束服务条件，用户也没有指令结束服务，则应对所有正在服务中的订单进行变量更新操作。
    4. 变量操作规则为最高优先级，应该严格遵照这个规定。
    5. **关键：为了保证操作准确性，必须明确建立ID到索引的映射关系。**
      - 必须显式输出：“当前订单ID `ORDER_X` 位于索引 `[n]`”。
      - 后续所有对 `服务中的订单[n]` 的操作必须严格基于此映射。
---