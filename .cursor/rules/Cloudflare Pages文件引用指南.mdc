# Cloudflare Pages æ–‡ä»¶å¼•ç”¨æŒ‡å—

## åˆ©ç”¨ Cloudflare Pages åˆ†å‘é™æ€æ–‡ä»¶

Cloudflare Pages æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å…è´¹é™æ€ç½‘ç«™æ‰˜ç®¡å¹³å°ï¼Œæ”¯æŒè‡ªåŠ¨éƒ¨ç½²å’Œå…¨çƒ CDN åˆ†å‘ã€‚å¯¹äºéƒ¨ç½²åœ¨ Cloudflare Pages ä¸­çš„æ–‡ä»¶ï¼Œä½ å¯ä»¥ç›´æ¥é€šè¿‡ä»¥ä¸‹ URL è®¿é—®å®ƒä»¬ï¼š

```
https://ä½ çš„é¡¹ç›®å.pages.dev/æ–‡ä»¶è·¯å¾„
```

## URL æ„æˆ

| ç»„ä»¶ | ç¤ºä¾‹ | è¯´æ˜ |
|------|------|------|
| **Pages åŸŸå** | `meituan-tavern-xjia.pages.dev` | æ¥è‡ª Cloudflare Pages çš„äºŒçº§åŸŸå |
| **æ–‡ä»¶è·¯å¾„** | `/image/è‹æ™´.jpg` | ç›¸å¯¹äº `dist` æ–‡ä»¶å¤¹çš„è·¯å¾„ |
| **å®Œæ•´ URL** | `https://meituan-tavern-xjia.pages.dev/image/è‹æ™´.jpg` | ç›´æ¥è®¿é—®æ–‡ä»¶ |

## å¿«é€Ÿç¤ºä¾‹

### ç¤ºä¾‹1ï¼šè„šæœ¬å¼•ç”¨ï¼ˆæ¨èç”¨äº Tavern Helper è„šæœ¬ï¼‰

```typescript
// åœ¨è„šæœ¬ä¸­å¯¼å…¥ JavaScript æ¨¡å—
import 'https://meituan-tavern-xjia.pages.dev/dist/è„šæœ¬/index.js'

// æˆ–è€…åœ¨ HTML ä¸­
<script src="https://meituan-tavern-xjia.pages.dev/dist/è„šæœ¬/index.js"></script>
```

### ç¤ºä¾‹2ï¼šå‰ç«¯ç•Œé¢åŠ è½½

```html
<!-- åœ¨é…’é¦†æ¶ˆæ¯ä¸­åŠ¨æ€åŠ è½½ç•Œé¢ -->
<body>
<script>
  $('body').load('https://meituan-tavern-xjia.pages.dev/dist/çŠ¶æ€æ /index.html')
</script>
</body>
```

### ç¤ºä¾‹3ï¼šCSS æ ·å¼è¡¨å¼•ç”¨

```html
<!-- åœ¨ HTML ä¸­å¼•ç”¨æ ·å¼ -->
<head>
  <link rel="stylesheet" href="https://meituan-tavern-xjia.pages.dev/dist/æ ·å¼/main.css">
</head>

<!-- æˆ–åœ¨ CSS ä¸­å¯¼å…¥ -->
<style>
  @import url("https://meituan-tavern-xjia.pages.dev/dist/æ ·å¼/theme.css");
</style>
```

### ç¤ºä¾‹4ï¼šå›¾ç‰‡å’Œåª’ä½“èµ„æº

```typescript
// åœ¨ TypeScript/JavaScript ä¸­
const imageUrl = 'https://meituan-tavern-xjia.pages.dev/image/è§’è‰².jpg';

// åœ¨ HTML ä¸­
<img src="https://meituan-tavern-xjia.pages.dev/image/è§’è‰².jpg" alt="è§’è‰²å¤´åƒ">
```

---

## ä¸ GitHub + jsdelivr çš„å¯¹æ¯”

| ç‰¹æ€§ | GitHub + jsdelivr | Cloudflare Pages |
|------|-------------------|------------------|
| **éƒ¨ç½²æ–¹å¼** | æ‰‹åŠ¨ç®¡ç†ç¼“å­˜ | âœ… è‡ªåŠ¨éƒ¨ç½² |
| **ç¼“å­˜åˆ·æ–°** | âš ï¸ éœ€è¦æ‰‹åŠ¨å¤„ç† | âœ… è‡ªåŠ¨æœ€æ–° |
| **å›½å†…é€Ÿåº¦** | ä¸­ç­‰ | â­â­â­â­â­ ä¼˜ç§€ |
| **å…¨çƒ CDN** | ä¾èµ– jsDelivr | âœ… Cloudflare å…¨çƒç½‘ç»œ |
| **è‡ªåŠ¨åŒ–ç¨‹åº¦** | ä½ | âœ… å®Œå…¨è‡ªåŠ¨åŒ– |
| **æˆæœ¬** | å…è´¹ | âœ… å…è´¹ |
| **é€‚ç”¨åœºæ™¯** | ä¸å¸¸æ›´æ–°çš„åº“ | âœ… é¢‘ç¹æ›´æ–°çš„é¡¹ç›® |

---

## ä½¿ç”¨åœºæ™¯è¯¦è§£

### åœºæ™¯1ï¼šåœ¨ Tavern Helper è„šæœ¬åº“ä¸­å¼•ç”¨è‡ªå·±çš„è„šæœ¬

**æ—§æ–¹æ³•ï¼ˆGitHub + jsdelivrï¼‰**ï¼š
```typescript
import 'https://testingcf.jsdelivr.net/gh/xuexix-alt/meituan-tavern-xjia@main/dist/è„šæœ¬/index.js'
```

**æ–°æ–¹æ³•ï¼ˆCloudflare Pagesï¼‰**ï¼š
```typescript
import 'https://meituan-tavern-xjia.pages.dev/dist/è„šæœ¬/index.js'
```

**ä¼˜åŠ¿**ï¼š
- âœ… æ— éœ€ `@main` åˆ†æ”¯æ ‡è®°
- âœ… æ— éœ€ç­‰å¾…ç¼“å­˜åˆ·æ–°
- âœ… æ›´æ–°ç«‹å³ç”Ÿæ•ˆ

---

### åœºæ™¯2ï¼šåœ¨æ¶ˆæ¯ä¸­åŠ¨æ€åŠ è½½å‰ç«¯ç•Œé¢

**åœ¨ STScript ä¸­**ï¼š
```
/run
$('body').load('https://meituan-tavern-xjia.pages.dev/dist/çŠ¶æ€æ /index.html')
```

**åœ¨ JavaScript ä¸­**ï¼š
```typescript
// ç«‹å³åŠ è½½
$('body').load('https://meituan-tavern-xjia.pages.dev/dist/çŠ¶æ€æ /index.html');

// æˆ–è€…è¿½åŠ åˆ°ç‰¹å®šå®¹å™¨
$('#message-container').load('https://meituan-tavern-xjia.pages.dev/dist/çŠ¶æ€æ /index.html');
```

---

### åœºæ™¯3ï¼šä½œä¸ºå›¾ç‰‡åº“ CDN

**åœ¨å‰ç«¯ç•Œé¢ä¸­**ï¼š
```typescript
const characterImages = {
  è‹æ™´: 'https://meituan-tavern-xjia.pages.dev/image/è‹æ™´.jpg',
  è‹æ™´1: 'https://meituan-tavern-xjia.pages.dev/image/è‹æ™´1.jpg',
  è‹æ™´2: 'https://meituan-tavern-xjia.pages.dev/image/è‹æ™´2.jpg',
};

// åœ¨ Vue ä¸­ä½¿ç”¨
<img :src="characterImages.è‹æ™´" alt="è‹æ™´">
```

**åœ¨ HTML ä¸­**ï¼š
```html
<img src="https://meituan-tavern-xjia.pages.dev/image/è‹æ™´.jpg" alt="è‹æ™´å¤´åƒ">
```

---

### åœºæ™¯4ï¼šæä¾›å…¬å…±èµ„æºç»™å…¶ä»–é¡¹ç›®

å¦‚æœä½ çš„ä»“åº“ä¸­æœ‰è®¸å¤šå¯å¤ç”¨çš„èµ„æºï¼Œå…¶ä»–å¼€å‘è€…å¯ä»¥ç›´æ¥å¼•ç”¨ï¼š

**ä»–äººçš„è„šæœ¬ä¸­**ï¼š
```typescript
// å¼•ç”¨ä½ çš„å›¾ç‰‡åº“
const myImageLibrary = 'https://meituan-tavern-xjia.pages.dev/image/';

// å¼•ç”¨ä½ çš„å·¥å…·è„šæœ¬
import utils from 'https://meituan-tavern-xjia.pages.dev/dist/utils/index.js';
```

---

## æœ€ä½³å®è·µ

### 1ï¸âƒ£ URL è§„èŒƒåŒ–

```typescript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨æ˜ç¡®çš„æ–‡ä»¶è·¯å¾„
const CDN_PREFIX = 'https://meituan-tavern-xjia.pages.dev/image';
const imageUrl = `${CDN_PREFIX}/è‹æ™´.jpg`;

// âŒ é¿å…ï¼šè·¯å¾„ä¸æ¸…æ™°
const imageUrl = 'https://meituan-tavern-xjia.pages.dev/è‹æ™´.jpg';
```

### 2ï¸âƒ£ ç‰ˆæœ¬ç®¡ç†å’Œç¼“å­˜ç­–ç•¥

```typescript
// æ–¹æ³•1ï¼šä½¿ç”¨æ—¥æœŸä½œä¸ºç¼“å­˜ç‰ˆæœ¬ï¼ˆå¼ºåˆ¶æ›´æ–°ï¼‰
const version = new Date().toISOString().split('T')[0];
const imageUrl = `https://meituan-tavern-xjia.pages.dev/image/è‹æ™´.jpg?v=${version}`;

// æ–¹æ³•2ï¼šåœ¨ package.json ä¸­ç»´æŠ¤ç‰ˆæœ¬å·
import { version } from './package.json';
const CDN_PREFIX = `https://meituan-tavern-xjia.pages.dev/dist?v=${version}`;
```

### 3ï¸âƒ£ é”™è¯¯å¤„ç†

```typescript
// æä¾›å¤‡é€‰æ–¹æ¡ˆ
const loadImageFromCDN = async (url: string, fallbackUrl?: string) => {
  try {
    const response = await fetch(url);
    if (!response.ok) throw new Error(`HTTP ${response.status}`);
    return url;
  } catch (error) {
    console.warn(`Failed to load ${url}:`, error);
    if (fallbackUrl) {
      console.log(`Trying fallback: ${fallbackUrl}`);
      return fallbackUrl;
    }
    return null;
  }
};

// ä½¿ç”¨
const imageUrl = await loadImageFromCDN(
  'https://meituan-tavern-xjia.pages.dev/image/è‹æ™´.jpg',
  'https://fallback-cdn.example.com/è‹æ™´.jpg'
);
```

### 4ï¸âƒ£ æ€§èƒ½ä¼˜åŒ–

```typescript
// é¢„åŠ è½½èµ„æº
const preloadImages = (urls: string[]) => {
  urls.forEach(url => {
    const link = document.createElement('link');
    link.rel = 'preload';
    link.as = 'image';
    link.href = url;
    document.head.appendChild(link);
  });
};

// ä½¿ç”¨
preloadImages([
  'https://meituan-tavern-xjia.pages.dev/image/è‹æ™´.jpg',
  'https://meituan-tavern-xjia.pages.dev/image/è‹æ™´1.jpg',
]);
```

---

## å¸¸è§é—®é¢˜

### Q1: æ–‡ä»¶æ›´æ–°åå¤šä¹…ç”Ÿæ•ˆï¼Ÿ

**A**: é€šå¸¸ç«‹å³ç”Ÿæ•ˆï¼ˆ<10 ç§’ï¼‰ã€‚Cloudflare Pages ä¼šè‡ªåŠ¨æ¸…é™¤æ–‡ä»¶çš„ç¼“å­˜ã€‚å¦‚æœé‡åˆ°æ—§æ–‡ä»¶ï¼Œå¯ä»¥ï¼š
1. å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨ï¼ˆCtrl+Shift+Rï¼‰
2. ä½¿ç”¨æŸ¥è¯¢å‚æ•°ç»•è¿‡ç¼“å­˜ï¼š`?t=æ—¶é—´æˆ³`

### Q2: å¦‚ä½•å¤„ç† CORS é—®é¢˜ï¼Ÿ

**A**: Cloudflare Pages é»˜è®¤å…è®¸è·¨åŸŸè®¿é—®ï¼Œä½†å¯ä»¥åœ¨ `_headers` æ–‡ä»¶ä¸­è‡ªå®šä¹‰ï¼š

```
# åœ¨ dist æ–‡ä»¶å¤¹æ ¹ç›®å½•åˆ›å»º _headers æ–‡ä»¶
/*
  Access-Control-Allow-Origin: *
  Access-Control-Allow-Methods: GET, HEAD, OPTIONS
```

### Q3: èƒ½å¦ä½¿ç”¨è‡ªå®šä¹‰åŸŸåï¼Ÿ

**A**: å¯ä»¥ã€‚åœ¨ Cloudflare åå°ï¼š
1. Pages é¡¹ç›® â†’ Settings â†’ Custom domains
2. æ·»åŠ ä½ çš„åŸŸåï¼ˆéœ€è¦ DNS æŒ‡å‘ Cloudflareï¼‰
3. ä½¿ç”¨è‡ªå®šä¹‰åŸŸåï¼š`https://cdn.ä½ çš„åŸŸå.com/image/è‹æ™´.jpg`

### Q4: æ–‡ä»¶å¤§å°æœ‰é™åˆ¶å—ï¼Ÿ

**A**:
- å•ä¸ªæ–‡ä»¶ï¼šæ— ç‰¹å®šé™åˆ¶ï¼Œä½†æ¨è <100MB
- é¡¹ç›®æ€»å¤§å°ï¼šå–å†³äº GitHub ä»“åº“é™åˆ¶ï¼ˆå»ºè®® <1GBï¼‰
- å»ºè®®å¯¹å¤§æ–‡ä»¶è¿›è¡Œå‹ç¼©ä¼˜åŒ–

### Q5: èƒ½å¦éšè—æŸäº›æ–‡ä»¶ï¼Ÿ

**A**: å¯ä»¥ã€‚åœ¨ `_redirects` æˆ– `_headers` ä¸­é…ç½®ï¼š

```
# é™åˆ¶å¯¹æŸäº›è·¯å¾„çš„è®¿é—®
/private/* 404

# æˆ–è¦æ±‚èº«ä»½éªŒè¯
/admin/* 401
```

---

## è¿ç§»æŒ‡å—

å¦‚æœä½ ä¹‹å‰ç”¨çš„æ˜¯ GitHub + jsdelivrï¼Œè¿ç§»åˆ° Cloudflare Pages å¾ˆç®€å•ï¼š

### æ­¥éª¤1ï¼šä¿®æ”¹æ‰€æœ‰ CDN å‰ç¼€

```typescript
// æ—§ä»£ç 
const CDN_PREFIX = 'https://testingcf.jsdelivr.net/gh/xuexix-alt/meituan-tavern-xjia@main/image';

// æ–°ä»£ç 
const CDN_PREFIX = 'https://meituan-tavern-xjia.pages.dev/image';
```

### æ­¥éª¤2ï¼šæ„å»ºå¹¶éƒ¨ç½²

```bash
pnpm build
git add .
git commit -m "Migrate from jsDelivr to Cloudflare Pages"
git push origin main
# Cloudflare è‡ªåŠ¨éƒ¨ç½²ï¼Œæ— éœ€å…¶ä»–æ“ä½œ
```

### æ­¥éª¤3ï¼šéªŒè¯

åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•æ–° URL æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚

---

## æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”

| æŒ‡æ ‡ | jsDelivr | Cloudflare Pages |
|------|----------|------------------|
| **å¹³å‡å»¶è¿Ÿ** | 100-300ms | 20-50ms |
| **ç¼“å­˜æ›´æ–°** | 12-24 å°æ—¶ | <10 ç§’ |
| **å…¨çƒèŠ‚ç‚¹** | ~300+ | âœ… 300+ (Cloudflare) |
| **å›½å†…é€Ÿåº¦** | ä¸­ç­‰ï¼ˆä¾èµ–è¿è¥å•†ï¼‰ | â­â­â­â­â­ ä¼˜ç§€ |

---

## æ€»ç»“

**ä½¿ç”¨ Cloudflare Pages çš„æ ¸å¿ƒä¼˜åŠ¿**ï¼š

âœ… **è‡ªåŠ¨åŒ–éƒ¨ç½²** - æ¨é€å³éƒ¨ç½²ï¼Œæ— éœ€æ‰‹åŠ¨åˆ·æ–°ç¼“å­˜
âœ… **å…¨çƒ CDN** - Cloudflare å…¨çƒ 300+ ä¸ªæ•°æ®ä¸­å¿ƒ
âœ… **å›½å†…ä¼˜åŒ–** - åœ¨å›½å†…æœ‰ä¼˜åŒ–çš„ç½‘ç»œè·¯ç”±
âœ… **é›¶æˆæœ¬** - å®Œå…¨å…è´¹
âœ… **å®æ—¶æ›´æ–°** - æ–‡ä»¶æ›´æ–°ç«‹å³ç”Ÿæ•ˆ
âœ… **æ— ç¼“å­˜çƒ¦æ¼** - è‡ªåŠ¨ç®¡ç†ç¼“å­˜ç­–ç•¥

**URL æ ¼å¼**ï¼š`https://ä½ çš„é¡¹ç›®å.pages.dev/æ–‡ä»¶è·¯å¾„`

ç«‹å³å¼€å§‹ä½¿ç”¨ Cloudflare Pages å§ï¼ğŸš€
